<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 6 页 | SamyChen</title>
  <meta name="author" content="SamyChen">
  
  <meta name="description" content="学习总结 思考感悟">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="SamyChen"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link rel="alternate" href="/atom.xml" title="SamyChen" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <!-- wumiiVerification -->
  <meta name="wumiiVerification" content="fb50a101-84fe-4ca2-91a7-ae8cf792978b" />
  <meta name="wumiiVerification" content="d73b5866-c390-4156-a4dd-51b526b5335e" />
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!-- Font-Awesome -->
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

</head>

<body>
  <header id="header"><div class= "header-content inner">
	<div class = "alignleft col-one">
		
			<div class='avatar'>
				<img src = "/img/default/head.jpg">
              </div>
		
		<div class="header-div">
		    <h1><a href="/">SamyChen</a></h1>
		    <h2><a href="/">SamyChen的博客</a></h2>
		</div>
	</div>
	<div class = "alignright col-two">
		
            <div class="ad">
			<img src = "/img/default/head.jpg">
            </div>
		
	</div>
	<div class="clearfix"></div>
</div>

<div class= "header-nav">
	<div class='header-nav-content inner'>
		<div id="main-nav" class="alignleft">
		    		
		    		  <a href="/"><i class="fa fa-home"></i>首页</a>
		    		
		    		  <a href="/archives"><i class="fa fa-archive"></i>归档</a>
		    		
		    		  <a href=""><i class="fa fa-book"></i>电子书</a>
		    		
		    		  <a href="/about"><i class="fa fa-user"></i>关于我</a>
		    		
		</div>
		<div id="sub-nav" class="alignright">
		    
		      <a href="https://github.com/samychen"><i class="fa fa-"></i>github</a>
		    
		      <a href="https://plus.google.com/u/0/"><i class="fa fa-"></i>google</a>
		    
		</div>
	</div>
	<div class="clearfix"></div>
</div>
</header>
  
    <div id="content" class="inner">
      <div id="main-col" class="alignleft"><div id="wrapper">
    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-05-11T06:06:15.000Z"><a href="/2016/05/11/android之View坐标系（view获取自身坐标的方法和点击事件中坐标的获取）/">2016-05-11</a></time>
        
  
    <h1 class="title"><a href="/2016/05/11/android之View坐标系（view获取自身坐标的方法和点击事件中坐标的获取）/">android之View坐标系（view获取自身坐标的方法和点击事件中坐标的获取）</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p>在做一个view背景特效的时候被坐标的各个获取方法搞晕了，几篇抄来抄去的博客也没弄很清楚。</p>
<p>现在把整个总结一下。</p>
<p>其实只要把下面这张图看明白就没问题了。<br><img src="http://upload-images.jianshu.io/upload_images/4398977-3251e6068bb1e1f5?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>涉及到的方法一共有下面几个：<br>view获取自身坐标：getLeft(),getTop(),getRight(),getBottom()<br>view获取自身宽高：getHeight(),getWidth()<br>motionEvent获取坐标：getX(),getY(),getRawX(),getRawY()<br>首先是view的几个方法，<br>获取自身的宽高的这两个方法很清楚，不用多说，获取坐标的这几个就有点混乱了。<br>根据上面的图应该会比较容易明白，图中屏幕上放了一个ViewGroup布局，里面有个View控件<br>getTop：获取到的，是view自身的顶边到其父布局顶边的距离<br>getLeft：获取到的，是view自身的左边到其父布局左边的距离<br>getRight：获取到的，是view自身的右边到其父布局左边的距离<br>getBottom：获取到的，是view自身的底边到其父布局顶边的距离</p>
<p>这些方法获取到的数据可以用在什么地方呢？比如要实现一个自定义的特殊布局，像<a href="http://blog.csdn.net/singwhatiwanna/article/details/42614953这里要实现的是一个水波纹特效布局，该布局内的任何控件点击后都会出现波纹效果" target="_blank" rel="external">http://blog.csdn.net/singwhatiwanna/article/details/42614953这里要实现的是一个水波纹特效布局，该布局内的任何控件点击后都会出现波纹效果</a><br>那么在点击了布局内的一个控件之后，就要通过不断刷新布局，去更新这个控件上面的波纹半径，为了节省资源，每次刷新布局都时候不会整个布局都刷新，而只是通过<br><code>postInvalidateDelayed(INVALIDATE_DURATION, left, top, right, bottom);</code></p>
<p>在布局的画布上每次只去更新点击事件所点击的对应的控件的位置，那么这里就可以用view的那四个方法，分别获取自身的四条边对应的坐标<br>从而让布局去刷新重绘。</p>
<p>当然博客中是使用绝对坐标去计算的，因为这里实现的是一个布局，可能里面还会嵌套另外的布局，经过多次嵌套之后所获取到的值，是相对于控件直接对应的父布局（这个布局有可能已经是我们重写的布局的子布局了）的距离，这样去刷新的区域肯定是不准确的，所以博客里面使用相对屏幕的绝对坐标计算需要刷新的控件区域。</p>
<p>如果这里自定义的不是布局，而只是一个控件的话，就可以通过以上方法获取到坐标，然后要求自己所在的布局去重绘这一区域就可以了。当然这只是一种思路，其实没必要去要求布局重绘，完全可以直接view自身重绘就可以了。</p>
<p>然后是motionEvent的方法：</p>
<p>getX()：获取点击事件相对控件左边的x轴坐标，即点击事件距离控件左边的距离</p>
<p>getY()：获取点击事件相对控件顶边的y轴坐标，即点击事件距离控件顶边的距离</p>
<p>getRawX()：获取点击事件相对整个屏幕左边的x轴坐标，即点击事件距离整个屏幕左边的距离</p>
<p>getRawY()：获取点击事件相对整个屏幕顶边的y轴坐标，即点击事件距离整个屏幕顶边的距离</p>
<p>这些方法可以用在什么地方呢？</p>
<p>getRawX和getRawY在之前那篇博客里广泛使用了，可以去那里看用法，getX()和getY()这两个方法在对view进行自定义的时候可能用的会比较多。</p>
<p>###<a href="http://www.cnblogs.com/virtual-young/p/4578424.html" target="_blank" rel="external">MotionEvent中getRawX、getRawY与getX、getY以及View中的getScrollX、getScrollY</a></p>
<p>1.getRawX、getRawY与getX、getY的区别<br>在编写android的自定义控件，或者判断用户手势操作时，往往需要使用MotionEvent中的getRawX()、getRawY()与getX()、getY()取得触摸点在X轴与Y轴上的距离，这四个方法都返回一个float类型的参数，单位为像素（Pixel）。getRawX()、getRawY()返回的是触摸点相对于屏幕的位置，而getX()、getY()返回的则是触摸点相对于View的位置。<br>以下两张图直观的表现了这几个方法的区别，在屏幕中央放置了一个Button，并为它注册了OnTouchListener，图中绿圆点为触摸点位置。<br><img src="http://upload-images.jianshu.io/upload_images/4398977-436d27429779abc8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">    <img src="http://upload-images.jianshu.io/upload_images/4398977-ea980ca264ad742c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>2.View中的getScrollX、getScrollY<br>getScrollX()与getScrollY()的值由调用View的scrollTo(int x, int y)或者scrollBy(int x, int y)产生，其中scrollTo是将View中的内容移动到指定的坐标x、y处，此x、y是相对于<br>View的左上角，而不是屏幕的左上角。scrollBy(int x, int y)则是改变View中的相对位置，参数x、y为距离上一次的相对位置。<br>文字解释总是不好理解的，那么我们就直接上图吧，直观一些。<br><img src="http://upload-images.jianshu.io/upload_images/4398977-66127203a89fb7c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><img src="http://upload-images.jianshu.io/upload_images/4398977-205675aec563fdea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><img src="http://upload-images.jianshu.io/upload_images/4398977-d6333d61fc2421dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>               （图1）                                                         （图2）                                                                （图3）<br>1.图1中，屏幕中心放置了一个button，而button的内容被放置在了它的左上角。<br>2.调用button的scrollTo(-100, -100)方法，结果如图2所示，button内的内容被移至相对button左上角(-100，-100)的位置<br>3.对图2的button调用scrollBy(-100,-100)方法，结果如图3所示，button内的内容被移至相对于图2的(-100,-100)位置<br>这时的getScrollX()与getScrollY()的值为：</p>
<p>06-15 15:44:56.072 20471-20471/com.test.yangy.studiotest V/ScrollActivity﹕ btn scroll X=-20006-15 15:44:56.072 20471-20471/com.test.yangy.studiotest V/ScrollActivity﹕ btn scroll Y=-200</p>
<p>值得注意的是，当View中的内容向右移动时，getScrollX()的值为负数，同理，向scrollTo与scrollBy的x中传入负数，view中的内容向右移动，反之向左。<br>当View中的内容向下移动时，getScrollY()的值为负数，同理，向scrollTo与scrollBy的y中传入负数，view中的内容向下移动，反之向上。</p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/05/11/android之View坐标系（view获取自身坐标的方法和点击事件中坐标的获取）/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-05-02T05:41:42.000Z"><a href="/2016/05/02/Java8新特性之lambda表达式入门/">2016-05-02</a></time>
        
  
    <h1 class="title"><a href="/2016/05/02/Java8新特性之lambda表达式入门/">Java8新特性之lambda表达式入门</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p>功能接口</p>
<p>只包含一个方法的接口被称为功能接口，Lambda 表达式用用于任何功能接口适用的地方，java.awt.event.ActionListener 就是一个功能接口，因为它只有一个方法：</p>
<p>void actionPerformed(ActionEvent)</p>
<p>一、lambda引入原因</p>
<p>1、更加紧凑的代码</p>
<p>比如Java中现有的匿名内部类以及监听器(listeners)和事件处理器(handlers）都显得很冗长</p>
<p>2、修改方法的能力</p>
<p>比如Collection接口的contains方法，当且仅当传入的元素真正包含在集合中，才返回true。而假如我们想对一个字符串集合，传入一个字符串，只要这个字符串出现在集合中（忽略大小写）就返回true。</p>
<p>简单地说，我们想要的是传入“一些我们自己的代码”到已有的方法中，已有的方法将会执行我们传入的代码。Lambda表达式能很好地支持这点</p>
<p>3、更好地支持多核处理</p>
<p>例如，通过Java 8新增的Lambda表达式，我们可以很方便地并行操作大集合，充分发挥多核CPU的潜能。</p>
<p>并行处理函数如filter、map和reduce。</p>
<p>实例1 FileFilter<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">File dir =newFile(&quot;/an/dir/&quot;);</div><div class="line"></div><div class="line">FileFilter directoryFilter=newFileFilter() &#123;public boolean accept(File file) &#123;</div><div class="line"></div><div class="line">returnfile.isDirectory();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>通过Lambda表达式这段代码可以简化为如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">File dir =newFile(&quot;/an/dir/&quot;);</div><div class="line"></div><div class="line">FileFilter directoryFilter= (File f) -&gt;f.isDirectory();</div><div class="line"></div><div class="line">File[] dirs= dir.listFiles(directoryFilter);</div></pre></td></tr></table></figure></p>
<p>进一步简化：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">File dir =newFile(&quot;/an/dir/&quot;)；</div><div class="line"></div><div class="line">File[] dirs= dir.listFiles((File f) -&gt; f.isDirectory());</div></pre></td></tr></table></figure></p>
<p>Lambda表达式利用了类型推断（type inference）技术：</p>
<p>编译器知道FileFilter只有一个方法accept()，所以accept()方法肯定对应(File f) -&gt; f.isDirectory()，就是利用了类型推断，而且accept()方法只有一个File类型的参数，所以(File f) -&gt;f.isDirectory()中的File f就是这个参数了，.NET把类型推断做得更绝，如果上面用.NET Lambda表达式写法的话是这样的：File[] dirs= dir.ListFiles(f =&gt;f.isDirectory());即压根就不需要出现File类型指示。</p>
<p>实例2 Event Handler<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Button bt =newButton();</div><div class="line"></div><div class="line">bt.addActionListener(newActionListener() &#123;public void actionPerformed(ActionEvent e) &#123;</div><div class="line"></div><div class="line">ui.showSomething();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>使用Lambda表达式后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Button bt =newButton();</div><div class="line"></div><div class="line">ActionListener listener= event -&gt;&#123; ui.showSomething(); &#125;;</div><div class="line"></div><div class="line">bt.addActionListener(listener);</div></pre></td></tr></table></figure></p>
<p>进一步简化：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Button bt =newButton();</div><div class="line"></div><div class="line">bt.addActionListener(event-&gt; &#123; ui.showSomething(); &#125;);</div></pre></td></tr></table></figure></p>
<p>newActionListener的内部类只有actionPerformed方法，event就是参数</p>
<p>actionPerformed()方法的返回类型是void，所以需要特殊处理，即在ui.showSomething();左右加上花括号。（想象下不加会怎么样？如果不加的话，若showSomething()方法返回值是整数类型，那么就意味着actionPerformed()返回整数类型，显然不是，所以必须加花括号用来标记）。</p>
<p>如果Lambda表达式主体部分包含多条语句，也必须用花括号，并且return语句不能省。</p>
<p>比如下面这个：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">File dir =newFile(&quot;/an/dir/&quot;);</div><div class="line"></div><div class="line">File[] dirs= dir.listFiles((File f) -&gt;&#123;</div><div class="line"></div><div class="line">System.out.println(&quot;Log:...&quot;);</div><div class="line"></div><div class="line">return f.isDirectory();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>函数集合</p>
<p>Java 8 的类库包含一个新的包 java.util.functions ，这个包中有很多新的功能接口，这些接口可与集合 API 一起使用。</p>
<p>外循环、内循环和Map、Reduce、Filter</p>
<p>一直到现在，处理Java集合的标准做法是采用外循环。比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">List list =newArrayList();</div><div class="line"></div><div class="line">list.add(&quot;hello&quot;);</div><div class="line"></div><div class="line">list.add(&quot;world&quot;);for(intitem: list) &#123;//处理item&#125;</div></pre></td></tr></table></figure></p>
<p>还有迭代器循环，它们都是外循环，并且都是顺序处理（sequential handling）。顺序特性也常常引发ConcurrentModificationException，只要我们尝试着并发修改集合。</p>
<p>Lambda表达式提供了内循环机制。</p>
<p>我们工作中可能经常面临下面的需求：</p>
<blockquote>
<p>过滤掉一个集合中不符合条件的元素得到一个新集合</p>
<p>对集合中的每个元素进行某种转换，并且对转换后的集合进行处理</p>
<p>统计整个集合的某个属性，比如统计集合元素值的总和或平均值</p>
</blockquote>
<p>这些任务即filter、map和reduce，他们的共同特点是：</p>
<p>需要对集合中的每个元素运行一小段相同的代码。</p>
<p>传统的实现这些任务的代码让人感到很乏味，幸运的是Java 8提供了完成这些任务的更简洁的方案，当然还是利用Lambda表达式，但也引入了一个新的类库java.util.functions，包含Predicate、Mapper和Block。</p>
<p>Java 8中，一个Predicate（谓词）是这样一个方法：它根据变量的值进行评估(evaluate），返回true或false。java.util.functions.Predicate</p>
<p>比如下面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">List list =getMyStrings();</div><div class="line"></div><div class="line">for(String myString: list) &#123;if(myString.contains(possible)) &#123;</div><div class="line"></div><div class="line">System.out.println(myString+ &quot; contains &quot; +possible);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用Predicate和Filter后得到下面代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">List list =getMyStrings();</div><div class="line"></div><div class="line">Predicate matched = s -&gt;s.equalsIgnoreCase(possible);</div><div class="line"></div><div class="line">list.filter(matched);</div></pre></td></tr></table></figure></p>
<p>进一步简化：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">List list =getMyStrings();</div><div class="line"></div><div class="line">list.filter(s-&gt; s.equalsIgnoreCase(possible));</div></pre></td></tr></table></figure></p>
<p>使用谓词 (Predicate) 来筛选集合：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">List names = Arrays.asList(&quot;Alice&quot;,&quot;Bob&quot;,&quot;Charlie&quot;,&quot;Dave&quot;);</div><div class="line"></div><div class="line">List filteredNames = names.filter(e -&gt; e.length() &gt;=4).into(new ArrayList());</div><div class="line"></div><div class="line">for(String name : filteredNames) &#123;</div><div class="line"></div><div class="line">System.out.println(name);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里我们有两个新方法：</p>
<p>Iterable filter(Predicate) 用于获取元素满足某个谓词返回 true 的结果</p>
<p><a extends="" fillableinto<?="" super="" t="">&gt;A into(A) 将用返回的结果填充 ArrayList </a></p>
<p>java.util.functions.Block</p>
<p>我们可使用一个新的迭代器方法来替换 for 循环 void forEach(Block&lt;? super T&gt;):</p>
<p>List names = Arrays.asList(“Alice”,”Bob”,”Charlie”,”Dave”);</p>
<p>names.filter(e -&gt; e.length() &gt;=4).forEach(e -&gt; { System.out.println(e); });<br>forEach() 方法是 internal iteration 的一个实例：迭代过程在 Iterable 和 Block 内部进行，每次可访问一个元素。</p>
<p>最后的结果就是用更少的代码来处理集合：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">List names = Arrays.asList(&quot;Alice&quot;,&quot;Bob&quot;,&quot;Charlie&quot;,&quot;Dave&quot;);</div><div class="line"></div><div class="line">names</div><div class="line"></div><div class="line">.mapped(e -&gt; &#123;return e.length(); &#125;)</div><div class="line"></div><div class="line">.asIterable()// returns an Iterable of BiValue elements</div><div class="line"></div><div class="line">// an element&apos;s key is the person&apos;s name, its value is the string length</div><div class="line"></div><div class="line">.filter(e -&gt; e.getValue() &gt;=4)</div><div class="line"></div><div class="line">.sorted((a, b) -&gt; a.getValue() - b.getValue())</div><div class="line"></div><div class="line">.forEach(e -&gt; &#123; System.out.println(e.getKey() +&apos;\t&apos;+ e.getValue()); &#125;);</div></pre></td></tr></table></figure></p>
<p>方法引用</p>
<p>我们可通过 :: 语法来引用某个方法。方法引用被认为是跟 Lambda 表达式一样的，可用于功能接口所适用的地方。</p>
<p>我们可以引用一个静态方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">executorService.submit(MethodReference::sayHello);</div><div class="line"></div><div class="line">privatestaticvoidsayHello() &#123;</div><div class="line"></div><div class="line">System.out.println(&quot;hello&quot;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>或者是一个实例的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Arrays.asList(&quot;Alice&quot;,&quot;Bob&quot;,&quot;Charlie&quot;,&quot;Dave&quot;).forEach(System.out::println);</div></pre></td></tr></table></figure></p>
<p>我们也可以创建工程方法并将构造器引用赋值给 java.util.functions.Factory:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Factory biscuitFactory = Biscuit::new;</div><div class="line"></div><div class="line">Biscuit biscuit = biscuitFactory.make();</div></pre></td></tr></table></figure></p>
<p>最后，我们创建一个引用到随意实例的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">interface Accessor&lt;BEAN, PROPERTY&gt; &#123;</div><div class="line"></div><div class="line">PROPERTY access(BEAN bean);</div><div class="line"></div><div class="line">&#125;</div><div class="line">publicstaticvoidmain(String[] args) &#123;</div><div class="line"></div><div class="line">Address address =newAddress(&quot;29 Acacia Road&quot;,&quot;Tunbridge Wells&quot;);</div><div class="line"></div><div class="line">Accessor accessor = Address::getCity;</div><div class="line"></div><div class="line">System.out.println(accessor.access(address));</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里我们无需绑定方法引用到某个实例，我们直接将实例做为功能接口的参数进行传递。</p>
<p>默认方法</p>
<p>直到今天的 Java ，都不可能为一个接口添加方法而不会影响到已有的实现类。而 Java 8 允许你为接口自身指定一个默认的实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">interface Queue &#123;</div><div class="line"></div><div class="line">Message read();</div><div class="line"></div><div class="line">void delete(Message message);</div><div class="line"></div><div class="line">void deleteAll()  default&#123;</div><div class="line"></div><div class="line">Message message;</div><div class="line"></div><div class="line">while((message = read()) !=null) &#123;</div><div class="line"></div><div class="line">delete(message);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>子接口可以覆盖默认的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">interface BatchQueue extends Queue &#123;</div><div class="line"></div><div class="line">void setBatchSize(int batchSize);</div><div class="line"></div><div class="line">void deleteAll()  default&#123;</div><div class="line"></div><div class="line">setBatchSize(100);</div><div class="line"></div><div class="line">Queue.super.deleteAll();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>或者子接口也可以通过重新声明一个没有方法体的方法来删除默认的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">interface FastQueue extends Queue &#123;</div><div class="line"></div><div class="line">void deleteAll();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/05/02/Java8新特性之lambda表达式入门/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-04-23T12:48:41.000Z"><a href="/2016/04/23/RXAndroid/">2016-04-23</a></time>
        
  
    <h1 class="title"><a href="/2016/04/23/RXAndroid/">RXAndroid</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#常见API"><span class="toc-text">常见API</span></a></li></ol>
    </div>

        <p>&emsp;&emsp;RxJava是一个基于可观测序列组成的异步的、基于事件的库。通俗一点说就是RxJava它是一个异步库，这个异步库可以让我们用非常简洁的代码来处理复杂数据流或者事件。</p>
<p>&emsp;&emsp;RxJava中两个最最基础的概念，一个是Observable，还有一个是Observer，其中Observable我们称之为被观察者，Observer称之为观察者，Observable用户发送消息，而Observer用于消费消息，在实际开发中，我们更多的是选择Observer的一个子类Subscriber来消费消息。在消息发送的过程中，Observable可以发送任意数量任意类型的消息（甚至一个将一个触摸事件当作一个消息发出），当Observable所发送的消息被成功处理或者消息出错时，一个流程结束。Observable会用它的每一个Subscriber（观察者）的onNext方法进行消息处理，在消息成功处理后以onComplete()方法结束流程，如果消息在处理的过程中出现了任何异常，则以onError()方法结束流程。比如下面几行代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Observable.OnSubscribe&lt;String&gt;() &#123;  </div><div class="line">            @Override  </div><div class="line">            public void call(Subscriber&lt;? super String&gt; subscriber) &#123;  </div><div class="line">                subscriber.onNext(&quot;哈哈哈哈&quot;);  </div><div class="line">                subscriber.onNext(&quot;lalalala&quot;);  </div><div class="line">                subscriber.onCompleted();  </div><div class="line">            &#125;  </div><div class="line">        &#125;)  </div><div class="line">                .subscribe(new Observer&lt;String&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public void onCompleted() &#123;  </div><div class="line">                        Log.d(&quot;google_lenve_fb&quot;, &quot;onCompleted: onCompleted()&quot;);  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onError(Throwable e) &#123;  </div><div class="line">                        Log.d(&quot;google_lenve_fb&quot;, &quot;onError:onError() &quot;);  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onNext(String s) &#123;  </div><div class="line">                        Log.d(&quot;google_lenve_fb&quot;, &quot;onNext: &quot; + s);  </div><div class="line">                    &#125;  </div><div class="line">                &#125;);</div></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;通过调用Observable的create方法来创建一个消息源，在它的onCall方法调用next方法来发送两条消息，当两条消息发送完成之后，调用onComplete方法表示消息发送完毕！subscribe表示订阅一条消息，在订阅的时候我们可以传入一个Observer对象，也可以传入一个Subscriber对象，这两个对象中的方法都是一样的，在onNext方法中处理消息，当消息处理完成之后会自动的调用onComplete方法，如果消息处理过程中出错，则会调用onError方法</p>
<p>如果我在onNext方法执行一行  1/0 ，onNext方法改成下面的样子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public void onNext(String s) &#123;  </div><div class="line">                        Log.d(&quot;google_lenve_fb&quot;, &quot;onNext: &quot; + s);  </div><div class="line">                        int i = 1 / 0;  </div><div class="line">                    &#125;</div></pre></td></tr></table></figure></p>
<p>打印结果如下：<br>onNext: 哈哈哈哈<br>onError:onError()   </p>
<p>当第一条消息打印出来之后，执行1/0时抛异常，直接调用了onError方法，第二条消息将不再处理</p>
<h4 id="常见API"><a href="#常见API" class="headerlink" title="常见API"></a>常见API</h4><ul>
<li>1 from函数<br>Observale中的from函数接受一个数组，这个方法返回一个按数组元素的顺序来发射这些数据的Observale</li>
<li>2  just函数<br>just函数它接受最多10个参数，返回一个按参数顺序发射这些数据的Observable</li>
<li>3 map函数<br>map函数可以对Observable创建的原始数据进行二次加工，然后再被观察者获取<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">Observable.from(new String[]&#123;&quot;Observable Test stringOne&quot;,&quot;Observable Test stringTwo&quot;&#125;)  </div><div class="line">                .map(new Func1&lt;String, String&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public String call(String s) &#123;  </div><div class="line">                        return s + &quot;---end&quot;;  </div><div class="line">                    &#125;  </div><div class="line">                &#125;)  </div><div class="line">                .subscribe(new Observer&lt;String&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public void onCompleted() &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onError(Throwable e) &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onNext(String s) &#123;  </div><div class="line">                        Log.d(&quot;google_lenve_fb&quot;, &quot;onNext: &quot; + s);  </div><div class="line">                    &#125;  </div><div class="line">                &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>打印结果如下：<br>Observable Test stringOne”—end<br>Observable Test stringTwo”—end<br>RxJava的使用都是链式编程，使用map函数时数据来源可以各种各样</p>
<ul>
<li>4 flatMap函数<br>flatMap函数接受一个Observable函数作为输入函数，然后在这个输入的基础上再创建一个新的Observable进行输出，比如下面一段代码：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[java] view plain copy print?Observable.just(&quot;Test stringOne&quot;, &quot;Test stringTwo&quot;)  </div><div class="line">                .flatMap(new Func1&lt;String, Observable&lt;String&gt;&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public Observable&lt;String&gt; call(String s) &#123;  </div><div class="line">                        return Observable.from(new  String[]&#123;s + &quot;endOne&quot;, s + &quot;endTwo&quot;&#125;);  </div><div class="line">                    &#125;  </div><div class="line">                &#125;).subscribe(new Subscriber&lt;String&gt;() &#123;  </div><div class="line">            @Override  </div><div class="line">            public void onCompleted() &#123;  </div><div class="line">  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onError(Throwable e) &#123;  </div><div class="line">  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onNext(String s) &#123;  </div><div class="line">                Log.d(&quot;google_lenve_fb&quot;, &quot;onNext: &quot; + s);  </div><div class="line">            &#125;  </div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>打印结果：<br>Test stringOneendOne<br>Test stringOneendTwo<br>Test stringTwoendOne<br>Test stringTwoendTwo</p>
<ul>
<li>5 scan函数<br>scan函数是一个累加器函数，对于Observable发射的每项数据进行累加，并将累加<br>的结果返回，如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">[java] view plain copy print?Observable.just(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)  </div><div class="line">                .scan(new Func2&lt;Integer, Integer, Integer&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public Integer call(Integer integer, Integer integer2) &#123;  </div><div class="line">                        return integer + integer2;  </div><div class="line">                    &#125;  </div><div class="line">                &#125;)  </div><div class="line">                .subscribe(new Observer&lt;Integer&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public void onCompleted() &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onError(Throwable e) &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onNext(Integer integer) &#123;  </div><div class="line">                        Log.d(&quot;google_lenve_fb&quot;, &quot;onNext: &quot; + integer);  </div><div class="line">                    &#125;  </div><div class="line">                &#125;);  </div><div class="line">        Observable.from(new String[]&#123;&quot;明&quot;, &quot;月&quot;, &quot;别&quot;, &quot;枝&quot;, &quot;惊&quot;, &quot;鹊&quot;&#125;)  </div><div class="line">                .scan(new Func2&lt;String, String, String&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public String call(String s, String s2) &#123;  </div><div class="line">                        return s + s2;  </div><div class="line">                    &#125;  </div><div class="line">                &#125;)  </div><div class="line">                .subscribe(new Subscriber&lt;String&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public void onCompleted() &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onError(Throwable e) &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onNext(String s) &#123;  </div><div class="line">                        Log.d(&quot;google_lenve&quot;, &quot;onNext: &quot; + s);  </div><div class="line">                    &#125;  </div><div class="line">                &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>打印结果如下：<br>D/google_lenve_fb: onNext: 1<br>D/google_lenve_fb: onNext: 3<br>D/google_lenve_fb: onNext: 6<br>D/google_lenve_fb: onNext: 10<br>D/google_lenve_fb: onNext: 15<br>D/google_lenve_fb: onNext: 21<br>D/google_lenve_fb: onNext: 28<br>D/google_lenve_fb: onNext: 36<br>D/google_lenve_fb: onNext: 45<br>D/google_lenve_fb: onNext: 55<br>D/google_lenve: onNext: 明<br>D/google_lenve: onNext: 明月<br>D/google_lenve: onNext: 明月别<br>D/google_lenve: onNext: 明月别枝<br>D/google_lenve: onNext: 明月别枝惊<br>D/google_lenve: onNext: 明月别枝惊鹊  </p>
<ul>
<li><p>6 elementAt函数<br>elementAt函数表示获取数据源中的第N项数据输出</p>
</li>
<li><p>7 merge函数<br>merge函数可以用来合并多个Observable数据源，然后将合并后的数据在一起输出，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[java] view plain copy print?Observable&lt;String&gt; observable1 = Observable.just(&quot;十里楼台倚翠薇&quot;, &quot;百花深处杜鹃啼&quot;);  </div><div class="line">        Observable&lt;String&gt; observable2 = Observable.just(&quot;殷勤自与行人语&quot;,&quot;不似流莺取次飞&quot;);  </div><div class="line">        Observable.merge(observable1, observable2)  </div><div class="line">                .subscribe(new Subscriber&lt;String&gt;() &#123;  </div><div class="line">                    @Override  </div><div class="line">                    public void onCompleted() &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onError(Throwable e) &#123;  </div><div class="line">  </div><div class="line">                    &#125;  </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onNext(String s) &#123;  </div><div class="line">                        Log.d(&quot;google_lenve&quot;, &quot;onNext: &quot;+s);  </div><div class="line">                    &#125;  </div><div class="line">                &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>打印结果如下：<br>D/google_lenve: onNext: 十里楼台倚翠薇<br>D/google_lenve: onNext: 百花深处杜鹃啼<br>D/google_lenve: onNext: 殷勤自与行人语<br>D/google_lenve: onNext: 不似流莺取次飞  </p>
<ul>
<li>8 zip函数<br>zip函数用来合并多个Observable的数据源，但是与merge不同的是，zip函数中可以对数据源进行二次操作，而不是简单的合并，代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[java] view plain copy print?Observable&lt;String&gt; observable1 = Observable.just(&quot;十里楼台倚翠薇&quot;, &quot;百花深处杜鹃啼&quot;);  </div><div class="line">        Observable&lt;String&gt; observable2 = Observable.just(&quot;问君能有几多愁&quot;,&quot;恰似一江春水向东流&quot;);  </div><div class="line">        Observable.zip(observable1, observable2, new Func2&lt;String, String, Object&gt;() &#123;  </div><div class="line">            @Override  </div><div class="line">            public Object call(String s, String s2) &#123;  </div><div class="line">                return s+s2;  </div><div class="line">            &#125;  </div><div class="line">        &#125;)  </div><div class="line">        .subscribe(new Subscriber&lt;Object&gt;() &#123;  </div><div class="line">            @Override  </div><div class="line">            public void onCompleted() &#123;  </div><div class="line">  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onError(Throwable e) &#123;  </div><div class="line">  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onNext(Object o) &#123;  </div><div class="line">                Log.d(&quot;google_lenve&quot;, &quot;onNext: &quot;+o.toString());  </div><div class="line">            &#125;  </div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>打印结果如下：<br>D/google_lenve: onNext: 十里楼台倚翠薇问君能有几多愁<br>D/google_lenve: onNext: 百花深处杜鹃啼恰似一江春水向东流  </p>
<ul>
<li>9 过滤函数<br>Observable函数中还有其他一些好用的过滤函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">private void m7() &#123;  </div><div class="line">    Observable.just(10, 12, 13, 14, 15, 16, 16, 16, 17, 18)  </div><div class="line">        //在数据序列的开头插入一条指定的项1  </div><div class="line">            .startWith(2)  </div><div class="line">            .filter(new Func1&lt;Integer, Boolean&gt;() &#123;  </div><div class="line">                @Override  </div><div class="line">                public Boolean call(Integer integer) &#123;  </div><div class="line">                    return integer &gt; 0;  </div><div class="line">                &#125;  </div><div class="line">            &#125;)  </div><div class="line">        //只发射前N个元素  </div><div class="line">            .take(2)  </div><div class="line">        //只发射最后N个元素  </div><div class="line">            .takeLast(2)  </div><div class="line">        //只发射第一个元素  </div><div class="line">            .first()  </div><div class="line">        //只发射最后一个元素  </div><div class="line">            .last()  </div><div class="line">        //跳过前两个  </div><div class="line">            .skip(2)  </div><div class="line">            //跳过最后两个  </div><div class="line">            .skipLast(2)  </div><div class="line">            //数据过滤，过滤掉重复数据  </div><div class="line">            .distinct()  </div><div class="line">            .subscribe(new Observer&lt;Integer&gt;() &#123;  </div><div class="line">                @Override  </div><div class="line">                public void onCompleted() &#123;  </div><div class="line">  </div><div class="line">                &#125;  </div><div class="line">  </div><div class="line">                @Override  </div><div class="line">                public void onError(Throwable e) &#123;  </div><div class="line">  </div><div class="line">                &#125;  </div><div class="line"> </div><div class="line">                @Override  </div><div class="line">                public void onNext(Integer integer) &#123;  </div><div class="line">                    Log.d(&quot;google_lenve_fb&quot;, &quot;onNext: &quot; + integer);  </div><div class="line">                &#125;  </div><div class="line">            &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>推荐参考<br><a href="http://wuxiaolong.me/2016/01/18/rxjava/" target="_blank" rel="external">RXJava</a><br><a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">给 Android 开发者的 RxJava 详解</a></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/04/23/RXAndroid/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-04-12T06:06:15.000Z"><a href="/2016/04/12/Invalid-double崩溃分析/">2016-04-12</a></time>
        
  
    <h1 class="title"><a href="/2016/04/12/Invalid-double崩溃分析/">Invalid double崩溃分析</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p>第一次遇到</p>
<p>java.lang.NumberFormatException: Invalid double: “0,3”<br>这样包含逗号的浮点数异常，第一感觉就是服务器给的数据错误，但前段时间复现了这个异常，才发现是代码不规范导致了这样的异常： 崩溃的详细log如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">E/AndroidRuntime: FATAL EXCEPTION: mainProcess: com.frank.lollipopdemo, PID: </div><div class="line">10898java.lang.RuntimeException: Unable to start activity </div><div class="line">ComponentInfo&#123;com.frank.lollipopdemo/com.frank.lollipopdemo.MainActivity&#125;: </div><div class="line">java.lang.NumberFormatException: Invalid double: &quot;0,3&quot; at </div><div class="line">android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2325) at </div><div class="line">android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2387) at </div><div class="line">android.app.ActivityThread.access$800(ActivityThread.java:151) at </div><div class="line">android.app.ActivityThread$H.handleMessage(ActivityThread.java:1303) at </div><div class="line">android.os.Handler.dispatchMessage(Handler.java:102) at android.os.Looper.loop(Looper.java:135) at </div><div class="line">android.app.ActivityThread.main(ActivityThread.java:5254) at java.lang.reflect.Method.invoke(Native </div><div class="line">Method) at java.lang.reflect.Method.invoke(Method.java:372) at </div><div class="line">com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:903) at </div><div class="line">com.android.internal.os.ZygoteInit.main(ZygoteInit.java:698) Caused by: </div><div class="line">java.lang.NumberFormatException: Invalid double: &quot;0,3&quot; at </div><div class="line">java.lang.StringToReal.invalidReal(StringToReal.java:63) at </div><div class="line">java.lang.StringToReal.initialParse(StringToReal.java:164) at </div><div class="line">java.lang.StringToReal.parseDouble(StringToReal.java:282) at </div><div class="line">java.lang.Double.parseDouble(Double.java:301) at </div><div class="line">com.frank.lollipopdemo.MainActivity.onCreate(MainActivity.java:43) at </div><div class="line">android.app.Activity.performCreate(Activity.java:5990) at </div><div class="line">android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1106) at </div><div class="line">android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2278) at </div><div class="line">android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2387) at </div><div class="line">android.app.ActivityThread.access$800(ActivityThread.java:151) at </div><div class="line">android.app.ActivityThread$H.handleMessage(ActivityThread.java:1303) at </div><div class="line">android.os.Handler.dispatchMessage(Handler.java:102) at android.os.Looper.loop(Looper.java:135) at </div><div class="line">android.app.ActivityThread.main(ActivityThread.java:5254) at java.lang.reflect.Method.invoke(Native </div><div class="line">Method) at java.lang.reflect.Method.invoke(Method.java:372) at </div><div class="line">com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:903) at</div><div class="line">com.android.internal.os.ZygoteInit.main(ZygoteInit.java:698)</div></pre></td></tr></table></figure></p>
<p>而出错的代码是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        tv_title = (TextView) findViewById(R.id.tv_title);</div><div class="line">        tv_content = (TextView) findViewById(R.id.tv_content);</div><div class="line">        String jsonVal = &quot;0.31415926&quot;;</div><div class="line">        String title = remain1Places(jsonVal);// -&gt; 0.3</div><div class="line">        tv_title.setText(title);</div><div class="line">        tv_content.setText(getPercent(Double.parseDouble(title)));// -&gt; ##.##%</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static String remain1Places(String string) &#123;</div><div class="line">        if (TextUtils.isEmpty(string)) &#123;</div><div class="line">            return &quot;&quot;;</div><div class="line">        &#125;</div><div class="line">        return String.format(&quot;%.1f&quot;, Double.parseDouble(string));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static String getPercent(double value) &#123;</div><div class="line">        NumberFormat numberFormat = NumberFormat.getPercentInstance();</div><div class="line">        numberFormat.setMinimumFractionDigits(1);</div><div class="line">        numberFormat.setMaximumFractionDigits(2);</div><div class="line">        return numberFormat.format(value);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>想把浮点数”0.31415926”保留一位小数，就使用了String.format()<br>方法完成，而且完全不顾编译器对我们的建议： <img src="http://upload-images.jianshu.io/upload_images/4398977-6b4a754e0cd9d8cb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="这里写图片描述">之后，我们想把保留了一位小数后的浮点数”0.3”转成百分比的形式”30.0%”，当然先转成double，然后利用NumberFormat<br>格式化成百分比。 看似没有问题，但是当我们把系统语言换成法语(France)之后，程序直接Crash，而且当我们只显示remain1Places()<br>后的title时，发现”0.31415926”变成了”0,3”，而不是”0.3”，这就直接导致了Double.parseDouble(“0,3”)抛出一个数据格式异常。 那为什么String.format()<br>会将小数点的”句点(.)“换成了”逗号(,)“呢？<br>摘自<a href="https://en.wikipedia.org/wiki/Decimal_mark" target="_blank" rel="external">维基百科</a>： A decimal mark is a symbol used to separate the integer part from the fractional part of a number written in decimal form. Different countries officially designate different symbols for the decimal mark. The choice of symbol for the decimal mark also affects the choice of symbol for the thousands separator used in digit grouping, so the latter is also treated in this article. <img src="http://upload-images.jianshu.io/upload_images/4398977-562e843356d6da5e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="这里写图片描述"></p>
<p>可以看到，有很多地区都是用<strong>逗号(,)</strong>作为<strong>小数点</strong>的，如19,90€表示19.9欧元；但计算机程序中的浮点数必须用<strong>句点(.)</strong>作为小数点，如double price = 19.90;<br>表示浮点数19.9。所以在使用double的包装类Double<br>的parseDouble(String)<br>或valueOf(String)<br>方法将字符串表示的double值转成double时，字符串所表示的double值必须是用<strong>句点(.)</strong>分隔的浮点数，也就是计算机的浮点数表示形式。<br>Double.valueOf(String)<br>方法仅仅调用了Double.parseDouble(String)<br>并返回Double<br>对象。 Double.parseDouble(String)<br>方法返回原语类型的double<br>变量。</p>
<p>因此，我们就可以断定这是一个本地化（Locale）的问题了。现在再来看一下编译器(lint)给我们String.format()<br>方法的建议：<br>Implicitly using the default locale is a common source of bugs: Use String.format(Locale, …) instead. 隐式地使用默认的区域设置是常见Bug源，请使用String.format(Locale, …)等方法替换它。</p>
<p>也就是说，String.format(String format, Object… args)<br>会调用format(Locale.getDefault(), format, args)<br>使用<strong>用户默认的区域设置</strong>返回格式化好且本地化好的字符串，因用户设置的不同而返回不同的字符串，进而出现Bug。如果你只是想格式化字符串而不是人为干预，应该用</p>
<p><code>String.format(Locale locale, String format, Object... args)</code><br>方法，Locale参数用Locale.US<br>就可以了。<br>因此，我们应该重视本地化问题：<br>将字符串所有字符转为大/小写的方法String.toLowerCase()<br>/String.toUpperCase()<br>并不一定能将字符真正的大/小写（如区域设置为土耳其时，i大写后还是i），因此应该指定要使用的区域设置String.toLowerCase(Locale locale)<br>/String.toUpperCase(Locale locale)<br>。<br>格式化字符串的方法String.format(String format, Object… args)<br>应该指定区域设置，以避免区域设置变化导致的Bug。<br><strong>千万不要将数字format()<br>成字符串后再将该字符串转回原语类型</strong>，因为format()<br>后的字符串可能不是合法的原语类型的数字了。即永远不要出现类似这样</p>
<p>Double.parseDouble(new DecimalFormat(“#.##”).format(doubleValue))<br>的代码。<br>建议使用NumberFormat<br>，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static String remain1Places(String str) &#123;</div><div class="line">    NumberFormat numberFormat = NumberFormat.getInstance(Locale.getDefault());</div><div class="line">    numberFormat.setMinimumFractionDigits(1);</div><div class="line">    numberFormat.setMaximumFractionDigits(1);</div><div class="line">    return numberFormat.format(Double.parseDouble(str));</div><div class="line">&#125;</div><div class="line"></div><div class="line">public static String getPercent(String str) &#123;</div><div class="line">    NumberFormat numberFormat = NumberFormat.getPercentInstance(Locale.getDefault());</div><div class="line">    numberFormat.setMinimumFractionDigits(1);</div><div class="line">    numberFormat.setMaximumFractionDigits(2);</div><div class="line">    return numberFormat.format(Double.parseDouble(str));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/04/12/Invalid-double崩溃分析/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-04-03T06:21:44.000Z"><a href="/2016/04/03/Android动态添加权限/">2016-04-03</a></time>
        
  
    <h1 class="title"><a href="/2016/04/03/Android动态添加权限/">Android动态添加权限</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p>一、工具</p>
<p>权限适配工具 PermissionsDispatcher</p>
<p>使用注解</p>
<p>@RuntimePermissions 是必须的注册当前activity或fragment</p>
<p>@NeedsPermission 是必须要有的，在需要权限的方法上添加</p>
<p>@OnShowRationale 注释一个方法解释为什么需要这个(个)权限并提示用户判断是否允许</p>
<p>@OnPermissionDenied 当权限被拒绝时调用</p>
<p>@OnNeverAskAgain 当用户勾选了不再提示时调用</p>
<p>使用方法：</p>
<p>注意：同一组内的任何一个权限被授权了，其他权限也自动被授权。例如，一旦READ_CALENDAR被授权了，应用也有WRITE_CALENDAR权限了。</p>
<p>参考文档</p>
<p>Demo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div></pre></td><td class="code"><pre><div class="line">@RuntimePermissions</div><div class="line"></div><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line"></div><div class="line">@Override</div><div class="line"></div><div class="line">protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line"></div><div class="line">super.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">findViewById(R.id.button_camera).setOnClickListener(this);</div><div class="line"></div><div class="line">findViewById(R.id.button_contacts).setOnClickListener(this);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line"></div><div class="line">public void onClick(@NonNull View v) &#123;</div><div class="line"></div><div class="line">switch (v.getId()) &#123;</div><div class="line"></div><div class="line">case R.id.button_camera:</div><div class="line"></div><div class="line">// NOTE: delegate the permission handling to generated method</div><div class="line"></div><div class="line">MainActivityPermissionsDispatcher.showCameraWithCheck(this);</div><div class="line"></div><div class="line">break;</div><div class="line"></div><div class="line">case R.id.button_contacts:</div><div class="line"></div><div class="line">// NOTE: delegate the permission handling to generated method</div><div class="line"></div><div class="line">MainActivityPermissionsDispatcher.showContactsWithCheck(this);</div><div class="line"></div><div class="line">break;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line"></div><div class="line">public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) &#123;</div><div class="line"></div><div class="line">super.onRequestPermissionsResult(requestCode, permissions, grantResults);</div><div class="line"></div><div class="line">// NOTE: delegate the permission handling to generated method</div><div class="line"></div><div class="line">MainActivityPermissionsDispatcher.onRequestPermissionsResult(this, requestCode, grantResults);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@NeedsPermission(Manifest.permission.CAMERA)</div><div class="line"></div><div class="line">void showCamera() &#123;</div><div class="line"></div><div class="line">// NOTE: Perform action that requires the permission. If this is run by PermissionsDispatcher, the permission will have been granted</div><div class="line"></div><div class="line">getSupportFragmentManager().beginTransaction()</div><div class="line"></div><div class="line">.replace(R.id.sample_content_fragment, CameraPreviewFragment.newInstance())</div><div class="line"></div><div class="line">.addToBackStack(&quot;camera&quot;)</div><div class="line"></div><div class="line">.commitAllowingStateLoss();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@NeedsPermission(&#123;Manifest.permission.READ_CONTACTS, Manifest.permission.WRITE_CONTACTS&#125;)</div><div class="line"></div><div class="line">void showContacts() &#123;</div><div class="line"></div><div class="line">// NOTE: Perform action that requires the permission.</div><div class="line"></div><div class="line">// If this is run by PermissionsDispatcher, the permission will have been granted</div><div class="line"></div><div class="line">getSupportFragmentManager().beginTransaction()</div><div class="line"></div><div class="line">.replace(R.id.sample_content_fragment, ContactsFragment.newInstance())</div><div class="line"></div><div class="line">.addToBackStack(&quot;contacts&quot;)</div><div class="line"></div><div class="line">.commitAllowingStateLoss();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@OnShowRationale(Manifest.permission.CAMERA)</div><div class="line"></div><div class="line">void showRationaleForCamera(PermissionRequest request) &#123;</div><div class="line"></div><div class="line">// NOTE: Show a rationale to explain why the permission is needed, e.g. with a dialog.</div><div class="line"></div><div class="line">// Call proceed() or cancel() on the provided PermissionRequest to continue or abort</div><div class="line"></div><div class="line">showRationaleDialog(R.string.permission_camera_rationale, request);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@OnShowRationale(&#123;Manifest.permission.READ_CONTACTS, Manifest.permission.WRITE_CONTACTS&#125;)</div><div class="line"></div><div class="line">void showRationaleForContact(PermissionRequest request) &#123;</div><div class="line"></div><div class="line">// NOTE: Show a rationale to explain why the permission is needed, e.g. with a dialog.</div><div class="line"></div><div class="line">// Call proceed() or cancel() on the provided PermissionRequest to continue or abort</div><div class="line"></div><div class="line">showRationaleDialog(R.string.permission_contacts_rationale, request);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@OnPermissionDenied(Manifest.permission.CAMERA)</div><div class="line"></div><div class="line">void onCameraDenied() &#123;</div><div class="line"></div><div class="line">// NOTE: Deal with a denied permission, e.g. by showing specific UI</div><div class="line"></div><div class="line">// or disabling certain functionality</div><div class="line"></div><div class="line">Toast.makeText(this, R.string.permission_camera_denied, Toast.LENGTH_SHORT).show();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@OnNeverAskAgain(Manifest.permission.CAMERA)</div><div class="line"></div><div class="line">void onCameraNeverAskAgain() &#123;</div><div class="line"></div><div class="line">Toast.makeText(this, R.string.permission_camera_never_askagain, Toast.LENGTH_SHORT).show();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">public void onBackClick(View view) &#123;</div><div class="line"></div><div class="line">getSupportFragmentManager().popBackStack();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">private void showRationaleDialog(@StringRes int messageResId, final PermissionRequest request) &#123;</div><div class="line"></div><div class="line">new AlertDialog.Builder(this)</div><div class="line"></div><div class="line">.setPositiveButton(R.string.button_allow, new DialogInterface.OnClickListener() &#123;</div><div class="line"></div><div class="line">@Override</div><div class="line"></div><div class="line">public void onClick(@NonNull DialogInterface dialog, int which) &#123;</div><div class="line"></div><div class="line">request.proceed();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line">.setNegativeButton(R.string.button_deny, new DialogInterface.OnClickListener() &#123;</div><div class="line"></div><div class="line">@Override</div><div class="line"></div><div class="line">public void onClick(@NonNull DialogInterface dialog, int which) &#123;</div><div class="line"></div><div class="line">request.cancel();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line">.setCancelable(false)</div><div class="line"></div><div class="line">.setMessage(messageResId)</div><div class="line"></div><div class="line">.show();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>权限适配工具 PermissionCompat</p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/04/03/Android动态添加权限/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



 
<nav id="pagination">
  
    <a href="/page/5/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/7/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
      <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title" id="categories">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cordova/">Cordova</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQTT/">MQTT</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SSL/">SSL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin/">kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安卓直播开发/">安卓直播开发</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">7</span></li></ul> 
</div>
 


  <div class="widget tag">
  <h3 class="title">微信公众账号</h3>
    <ul class="entry">
      <img src="/img/default/wx.png" alt="欢迎关注，该账号供个人学习使用，主要分享安卓开发技术以及前沿技术。" style= "width: 100%">
    </ul>
</div>

  <div class="widget tag">
  <h3 class="title">日历云</h3>
  <div id="calendar"></div>
</div>


  
<div class="widget">
  <h3 class="title">最新评论</h3>
  	<!-- 多说最新评论 start -->
	<div class="ds-recent-comments ds-recent-user" data-num-items="5" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></div>
	<!-- 多说最新评论 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"samychen"};
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0] 
			 || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
		</script>
	<!-- 多说公共JS代码 end -->
</div>



  


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Cordova/" style="font-size: 15px;">Cordova</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MQTT/" style="font-size: 11.67px;">MQTT</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/SSL，Https/" style="font-size: 13.33px;">SSL，Https</a> <a href="/tags/SSL，Https，安卓/" style="font-size: 10px;">SSL，Https，安卓</a> <a href="/tags/单例模式/" style="font-size: 11.67px;">单例模式</a> <a href="/tags/安卓/" style="font-size: 16.67px;">安卓</a> <a href="/tags/安卓，Java/" style="font-size: 18.33px;">安卓，Java</a> <a href="/tags/工厂模式/" style="font-size: 10px;">工厂模式</a> <a href="/tags/生产者消费者模式/" style="font-size: 11.67px;">生产者消费者模式</a> <a href="/tags/网络协议/" style="font-size: 10px;">网络协议</a> <a href="/tags/装饰者模式/" style="font-size: 11.67px;">装饰者模式</a>
  </div>
</div>


  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">公元 2017 年</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">公元 2016 年</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">公元 2015 年</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/">公元 2014 年</a><span class="archive-list-count">10</span></li></ul>
  </div>

</aside>
      <div class="clearfix"></div>
    </div>
  
  <footer id="footer"><div class="footer-content inner">
  <div class="alignleft">
  
    &copy; 2018 SamyChen
    
  </div>
  <div class="alignright">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme
    <a href="https://github.com/pengloo53/Hexo-theme-light_cn">light_cn</a>
  </div>
  
  <div class="visit">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </div>
  
  <div class="clearfix"></div>
</div></footer>
  <script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<!-- calendar widget -->

  <script src="/js/calendar.js"></script>
  <script src="/js/languages.js"></script>
  <script type="text/javascript">
    $(function() {
    
      $('#calendar').aCalendar('zh-CN',{single:undefined, root:'calendar'});
    
    });
  </script>


<!-- 『不蒜子』计数服务 -->
<script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- wumii关联推荐 -->
<script type="text/javascript" src="http://widget.wumii.cn/ext/relatedItemsWidget"></script>

<!-- 百度推荐 -->

	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?9acf0cedd48dc53be256ede5a98c2aaa";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


<!-- 返回顶部 -->
<div id="toTop">
	<a href="#">▲</a>
	<a href="#footer">▼</a>
</div>

<!-- 站内搜索-Swiftype -->
<!-- <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','sC-iNFrvTTNtiXEVNwo1','2.0.0');
</script> -->

<!-- fancybox -->

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
