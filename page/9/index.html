<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 9 页 | SamyChen</title>
  <meta name="author" content="SamyChen">
  
  <meta name="description" content="学习总结 思考感悟">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="SamyChen"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link rel="alternate" href="/atom.xml" title="SamyChen" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <!-- wumiiVerification -->
  <meta name="wumiiVerification" content="fb50a101-84fe-4ca2-91a7-ae8cf792978b" />
  <meta name="wumiiVerification" content="d73b5866-c390-4156-a4dd-51b526b5335e" />
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!-- Font-Awesome -->
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

</head>

<body>
  <header id="header"><div class= "header-content inner">
	<div class = "alignleft col-one">
		
			<div class='avatar'>
				<img src = "/img/default/head.jpg">
              </div>
		
		<div class="header-div">
		    <h1><a href="/">SamyChen</a></h1>
		    <h2><a href="/">SamyChen的博客</a></h2>
		</div>
	</div>
	<div class = "alignright col-two">
		
            <div class="ad">
			<img src = "/img/default/head.jpg">
            </div>
		
	</div>
	<div class="clearfix"></div>
</div>

<div class= "header-nav">
	<div class='header-nav-content inner'>
		<div id="main-nav" class="alignleft">
		    		
		    		  <a href="/"><i class="fa fa-home"></i>首页</a>
		    		
		    		  <a href="/archives"><i class="fa fa-archive"></i>归档</a>
		    		
		    		  <a href=""><i class="fa fa-book"></i>电子书</a>
		    		
		    		  <a href="/about"><i class="fa fa-user"></i>关于我</a>
		    		
		</div>
		<div id="sub-nav" class="alignright">
		    
		      <a href="https://github.com/samychen"><i class="fa fa-"></i>github</a>
		    
		      <a href="https://plus.google.com/u/0/103829504368344048794"><i class="fa fa-"></i>google</a>
		    
		</div>
	</div>
	<div class="clearfix"></div>
</div>
</header>
  
    <div id="content" class="inner">
      <div id="main-col" class="alignleft"><div id="wrapper">
    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-02-22T05:39:47.000Z"><a href="/2016/02/22/Java-SSL-Socket通讯实例一/">2016-02-22</a></time>
        
  
    <h1 class="title"><a href="/2016/02/22/Java-SSL-Socket通讯实例一/">Java SSL Socket通讯实例一</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Server端代码"><span class="toc-text">Server端代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Client代码"><span class="toc-text">Client代码</span></a></li></ol>
    </div>

        <p>从最简单来说，Java里面只需要配置几个系统属性，创建及调用几个SSL相关的对象即可。这四个属性分别是:<br>javax.net.ssl.keyStore本方的密码，证书等存放地点(KeyStore文件地址)。<br>javax.net.ssl.keyStorePasswordKeyStore的密码。没有密码可以不填。<br>javax.net.ssl.trustStore受信任证书的存放地点(TrustKeyStore文件地址)。<br>javax.net.ssl.trustStorePasswordTrustKeyStore的密码。没有密码可以不填。</p>
<p>KeyStore类型默认是JKS类型的，不是的话，还需要设置 javax<a href="http://lib.csdn.net/base/dotnet" target="_blank" rel="external">.NET</a>.ssl.keyStoreType和javax<a href="http://lib.csdn.net/base/dotnet" target="_blank" rel="external">.Net</a>.ssl.trustStoreType。</p>
<h4 id="Server端代码"><a href="#Server端代码" class="headerlink" title="Server端代码"></a>Server端代码</h4><p>每一次收新的连接，都新开一个线程接待。生产上请用线程池等技术。更推荐用Netty或Mina等框架处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">public class SslServer &#123;</div><div class="line">		public static void main(String[] args) throws Exception &#123;</div><div class="line">			System.setProperty(&quot;javax.net.debug&quot;, &quot;ssl,handshake&quot;);</div><div class="line"></div><div class="line">			System.setProperty(&quot;javax.net.ssl.keyStore&quot;, &quot;./cfg/server.jks&quot;);</div><div class="line">			System.setProperty(&quot;javax.net.ssl.keyStorePassword&quot;, &quot;123456&quot;);</div><div class="line">			System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;./cfg/clienttrust.jks&quot;);</div><div class="line">			System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;123456&quot;);</div><div class="line"></div><div class="line">			SSLServerSocketFactory serverSocketFactory = (SSLServerSocketFactory) SSLServerSocketFactory</div><div class="line">					.getDefault();</div><div class="line">			SSLServerSocket serverSocket = (SSLServerSocket) serverSocketFactory</div><div class="line">					.createServerSocket(9100);</div><div class="line">			// 要求客户端身份验证</div><div class="line">			serverSocket.setNeedClientAuth(true);</div><div class="line"></div><div class="line">			while (true) &#123;</div><div class="line">				SSLSocket socket = (SSLSocket) serverSocket.accept();</div><div class="line">				Accepter accepter = new Accepter(socket);</div><div class="line">				accepter.service();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		static class Accepter implements Runnable &#123;</div><div class="line">			private SSLSocket socket;</div><div class="line"></div><div class="line">			public Accepter(SSLSocket socket) &#123;</div><div class="line">				this.socket = socket;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			public void service() &#123;</div><div class="line">				Thread thread = new Thread(this);</div><div class="line">				thread.start();</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			@Override</div><div class="line">			public void run() &#123;</div><div class="line">				try &#123;</div><div class="line">					InputStream inputStream = socket.getInputStream();</div><div class="line"></div><div class="line">					InputStreamReader inputstreamreader = new InputStreamReader(</div><div class="line">							inputStream);</div><div class="line">					BufferedReader bufferedreader = new BufferedReader(</div><div class="line">							inputstreamreader);</div><div class="line"></div><div class="line">					String string = null;</div><div class="line">					while ((string = bufferedreader.readLine()) != null) &#123;</div><div class="line">						System.out.println(string);</div><div class="line">						System.out.flush();</div><div class="line">					&#125;</div><div class="line">				&#125; catch (Exception e) &#123;</div><div class="line">					// replace with other code</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Client代码"><a href="#Client代码" class="headerlink" title="Client代码"></a>Client代码</h4><p>建立连接，并发一个消息给Server。很简单。记得换行符以及调用flush方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public class SslClient &#123;</div><div class="line">		public static void main(String[] args) throws Exception &#123;</div><div class="line">			System.setProperty(&quot;javax.net.debug&quot;, &quot;ssl,handshake&quot;);</div><div class="line"></div><div class="line">			System.setProperty(&quot;javax.net.ssl.keyStore&quot;, &quot;./cfg/client.jks&quot;);</div><div class="line">			System.setProperty(&quot;javax.net.ssl.keyStorePassword&quot;, &quot;123456&quot;);</div><div class="line">			System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;./cfg/servertrust.jks&quot;);</div><div class="line">			System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;123456&quot;);</div><div class="line"></div><div class="line">			SSLSocketFactory sslsocketfactory = (SSLSocketFactory) SSLSocketFactory</div><div class="line">					.getDefault();</div><div class="line">			SSLSocket sslsocket = (SSLSocket) sslsocketfactory.createSocket(</div><div class="line">					&quot;127.0.0.1&quot;, 9100);</div><div class="line"></div><div class="line">			OutputStream outputStream = sslsocket.getOutputStream();</div><div class="line">			BufferedWriter bufferedWriter = new BufferedWriter(</div><div class="line">					new OutputStreamWriter(outputStream));</div><div class="line">			bufferedWriter.write(&quot;沉睡的雄狮\n&quot;);</div><div class="line">			bufferedWriter.flush();</div><div class="line"></div><div class="line">			TimeUnit.SECONDS.sleep(2000);</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>结束语<br>JDK后来加了SSLEngine这个类，具有异步通讯的能力。不过看官方文档，给出的代码很长。还是那句话，有条件的推荐用Netty或者Mina来处理通讯的问题，应该会比自己写的性能好一些。<br><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html" target="_blank" rel="external">Java官方SSL Socket文档</a></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/02/22/Java-SSL-Socket通讯实例一/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-02-12T05:36:47.000Z"><a href="/2016/02/12/失效的private修饰符/">2016-02-12</a></time>
        
  
    <h1 class="title"><a href="/2016/02/12/失效的private修饰符/">失效的private修饰符</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p>在Java编程中，使用private关键字修饰了某个成员，只有这个成员所在的类和这个类的方法可以使用，其他的类都无法访问到这个private成员。</p>
<p>上面描述了private修饰符的基本职能，今天来研究一下private功能失效的情况。</p>
<p>Java内部类</p>
<p>在Java中相信很多人都用过内部类，Java允许在一个类里面定义另一个类，类里面的类就是内部类，也叫做嵌套类。一个简单的内部类实现可以如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class OuterClass &#123;</div><div class="line">    class InnerClass&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>今天的问题和Java内部类相关，只涉及到部分和本文研究相关的内部类知识，具体关于Java内部类后续的文章会介绍。</p>
<p>第一次失效?</p>
<p>一个我们在编程中经常用到的场景，就是在一个内部类里面访问外部类的private成员变量或者方法，这是可以的。如下面的代码实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class OuterClass &#123;</div><div class="line">  private String language = &quot;en&quot;;</div><div class="line">  private String region = &quot;US&quot;;</div><div class="line">  </div><div class="line">  </div><div class="line">  public class InnerClass &#123;</div><div class="line">      public void printOuterClassPrivateFields() &#123;</div><div class="line">          String fields = &quot;language=&quot; + language + &quot;;region=&quot; + region;</div><div class="line">          System.out.println(fields);</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  public static void main(String[] args) &#123;</div><div class="line">      OuterClass outer = new OuterClass();</div><div class="line">      OuterClass.InnerClass inner = outer.new InnerClass();</div><div class="line">      inner.printOuterClassPrivateFields();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这是为什么呢，不是private修饰的成员只能被成员所述的类才能访问么？难道private真的失效了么？</p>
<p>编译器在捣鬼？</p>
<p>我们使用javap命令查看一下生成的两个class文件</p>
<p>OuterClass的反编译结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">15:30 $ javap -c  OuterClass</div><div class="line">Compiled from &quot;OuterClass.java&quot;</div><div class="line">public class OuterClass extends java.lang.Object&#123;</div><div class="line">public OuterClass();</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  invokespecial    #11; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</div><div class="line">   4:  aload_0</div><div class="line">   5:  ldc  #13; //String en</div><div class="line">   7:  putfield #15; //Field language:Ljava/lang/String;</div><div class="line">   10: aload_0</div><div class="line">   11: ldc  #17; //String US</div><div class="line">   13: putfield #19; //Field region:Ljava/lang/String;</div><div class="line">   16: return</div><div class="line"></div><div class="line">public static void main(java.lang.String[]);</div><div class="line">  Code:</div><div class="line">   0:  new  #1; //class OuterClass</div><div class="line">   3:  dup</div><div class="line">   4:  invokespecial    #27; //Method &quot;&lt;init&gt;&quot;:()V</div><div class="line">   7:  astore_1</div><div class="line">   8:  new  #28; //class OuterClass$InnerClass</div><div class="line">   11: dup</div><div class="line">   12: aload_1</div><div class="line">   13: dup</div><div class="line">   14: invokevirtual    #30; //Method java/lang/Object.getClass:()Ljava/lang/Class;</div><div class="line">   17: pop</div><div class="line">   18: invokespecial    #34; //Method OuterClass$InnerClass.&quot;&lt;init&gt;&quot;:(LOuterClass;)V</div><div class="line">   21: astore_2</div><div class="line">   22: aload_2</div><div class="line">   23: invokevirtual    #37; //Method OuterClass$InnerClass.printOuterClassPrivateFields:()V</div><div class="line">   26: return</div><div class="line"></div><div class="line">static java.lang.String access$0(OuterClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  getfield #15; //Field language:Ljava/lang/String;</div><div class="line">   4:  areturn</div><div class="line"></div><div class="line">static java.lang.String access$1(OuterClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  getfield #19; //Field region:Ljava/lang/String;</div><div class="line">   4:  areturn</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>咦？不对，在OuterClass中我们并没有定义这两个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">static java.lang.String access$0(OuterClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  getfield #15; //Field language:Ljava/lang/String;</div><div class="line">   4:  areturn</div><div class="line"></div><div class="line">static java.lang.String access$1(OuterClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  getfield #19; //Field region:Ljava/lang/String;</div><div class="line">   4:  areturn</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从给出来的注释来看，access$0返回outerClass的language属性；access$1返回outerClass的region属性。并且这两个方法都接受OuterClass的实例作为参数。这两个方法为什么生成呢，有什么作用呢？我们看一下内部类的反编译结果就知道了。</p>
<p>OuterClass$InnerClass的反编译结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">15:37 $ javap -c OuterClass\$InnerClass</div><div class="line">Compiled from &quot;OuterClass.java&quot;</div><div class="line">public class OuterClass$InnerClass extends java.lang.Object&#123;</div><div class="line">final OuterClass this$0;</div><div class="line"></div><div class="line">public OuterClass$InnerClass(OuterClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  aload_1</div><div class="line">   2:  putfield #10; //Field this$0:LOuterClass;</div><div class="line">   5:  aload_0</div><div class="line">   6:  invokespecial    #12; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</div><div class="line">   9:  return</div><div class="line"></div><div class="line">public void printOuterClassPrivateFields();</div><div class="line">  Code:</div><div class="line">   0:  new  #20; //class java/lang/StringBuilder</div><div class="line">   3:  dup</div><div class="line">   4:  ldc  #22; //String language=</div><div class="line">   6:  invokespecial    #24; //Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</div><div class="line">   9:  aload_0</div><div class="line">   10: getfield #10; //Field this$0:LOuterClass;</div><div class="line">   13: invokestatic #27; //Method OuterClass.access$0:(LOuterClass;)Ljava/lang/String;</div><div class="line">   16: invokevirtual    #33; //Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</div><div class="line">   19: ldc  #37; //String ;region=</div><div class="line">   21: invokevirtual    #33; //Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</div><div class="line">   24: aload_0</div><div class="line">   25: getfield #10; //Field this$0:LOuterClass;</div><div class="line">   28: invokestatic #39; //Method OuterClass.access$1:(LOuterClass;)Ljava/lang/String;</div><div class="line">   31: invokevirtual    #33; //Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</div><div class="line">   34: invokevirtual    #42; //Method java/lang/StringBuilder.toString:()Ljava/lang/String;</div><div class="line">   37: astore_1</div><div class="line">   38: getstatic    #46; //Field java/lang/System.out:Ljava/io/PrintStream;</div><div class="line">   41: aload_1</div><div class="line">   42: invokevirtual    #52; //Method java/io/PrintStream.println:(Ljava/lang/String;)V</div><div class="line">   45: return</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下面代码调用access$0的代码,其目的是得到OuterClass的language 私有属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">13:   invokestatic #27; //Method OuterClass.access$0:(LOuterClass;)Ljava/lang/String;</div></pre></td></tr></table></figure></p>
<p>下面代码调用了access$1的代码，其目的是得到OutherClass的region 私有属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">28:   invokestatic #39; //Method OuterClass.access$1:(LOuterClass;)Ljava/lang/String;</div></pre></td></tr></table></figure></p>
<p>注意：在内部类构造的时候，会将外部类的引用传递进来，并且作为内部类的一个属性，所以内部类会持有一个其外部类的引用。<br>this$0就是内部类持有的外部类引用，通过构造方法传递引用并赋值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">final OuterClass this$0;</div><div class="line"></div><div class="line">public OuterClass$InnerClass(OuterClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  aload_1</div><div class="line">   2:  putfield #10; //Field this$0:LOuterClass;</div><div class="line">   5:  aload_0</div><div class="line">   6:  invokespecial    #12; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</div><div class="line">   9:  return</div></pre></td></tr></table></figure>
<p>小结</p>
<p>这部分private看上去失效可，实际上并没有失效，因为当内部类调用外部类的私有属性时，其真正的执行是调用了编译器生成的属性的静态方法（即acess$0,access$1等）来获取这些属性值。这一切都是编译器的特殊处理。<br>这次也失效？</p>
<p>如果说上面的写法很常用，那么这样的写法是不是很少接触，但是却可以运行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class AnotherOuterClass &#123;</div><div class="line">  public static void main(String[] args) &#123;</div><div class="line">      InnerClass inner = new AnotherOuterClass().new InnerClass();</div><div class="line">      System.out.println(&quot;InnerClass Filed = &quot; + inner.x);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  class InnerClass &#123;</div><div class="line">      private int x = 10;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>和上面一样，使用javap反编译看一下。不过这次我们先看一下InnerClass的结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">16:03 $ javap -c AnotherOuterClass\$InnerClass</div><div class="line">Compiled from &quot;AnotherOuterClass.java&quot;</div><div class="line">class AnotherOuterClass$InnerClass extends java.lang.Object&#123;</div><div class="line">final AnotherOuterClass this$0;</div><div class="line"></div><div class="line">AnotherOuterClass$InnerClass(AnotherOuterClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  aload_1</div><div class="line">   2:  putfield #12; //Field this$0:LAnotherOuterClass;</div><div class="line">   5:  aload_0</div><div class="line">   6:  invokespecial    #14; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</div><div class="line">   9:  aload_0</div><div class="line">   10: bipush   10</div><div class="line">   12: putfield #17; //Field x:I</div><div class="line">   15: return</div><div class="line"></div><div class="line">static int access$0(AnotherOuterClass$InnerClass);</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  getfield #17; //Field x:I</div><div class="line">   4:  ireturn</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>又出现了，编译器又自动生成了一个获取私有属性的后门方法access$0一次来获取x的值。</p>
<p>AnotherOuterClass.class的反编译结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">16:08 $ javap -c AnotherOuterClass</div><div class="line">Compiled from &quot;AnotherOuterClass.java&quot;</div><div class="line">public class AnotherOuterClass extends java.lang.Object&#123;</div><div class="line">public AnotherOuterClass();</div><div class="line">  Code:</div><div class="line">   0:  aload_0</div><div class="line">   1:  invokespecial    #8; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</div><div class="line">   4:  return</div><div class="line"></div><div class="line">public static void main(java.lang.String[]);</div><div class="line">  Code:</div><div class="line">   0:  new  #16; //class AnotherOuterClass$InnerClass</div><div class="line">   3:  dup</div><div class="line">   4:  new  #1; //class AnotherOuterClass</div><div class="line">   7:  dup</div><div class="line">   8:  invokespecial    #18; //Method &quot;&lt;init&gt;&quot;:()V</div><div class="line">   11: dup</div><div class="line">   12: invokevirtual    #19; //Method java/lang/Object.getClass:()Ljava/lang/Class;</div><div class="line">   15: pop</div><div class="line">   16: invokespecial    #23; //Method AnotherOuterClass$InnerClass.&quot;&lt;init&gt;&quot;:(LAnotherOuterClass;)V</div><div class="line">   19: astore_1</div><div class="line">   20: getstatic    #26; //Field java/lang/System.out:Ljava/io/PrintStream;</div><div class="line">   23: new  #32; //class java/lang/StringBuilder</div><div class="line">   26: dup</div><div class="line">   27: ldc  #34; //String InnerClass Filed =</div><div class="line">   29: invokespecial    #36; //Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</div><div class="line">   32: aload_1</div><div class="line">   33: invokestatic #39; //Method AnotherOuterClass$InnerClass.access$0:(LAnotherOuterClass$InnerClass;)I</div><div class="line">   36: invokevirtual    #43; //Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</div><div class="line">   39: invokevirtual    #47; //Method java/lang/StringBuilder.toString:()Ljava/lang/String;</div><div class="line">   42: invokevirtual    #51; //Method java/io/PrintStream.println:(Ljava/lang/String;)V</div><div class="line">   45: return</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中这句调用就是外部类通过内部类的实例获取私有属性x的操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">33:   invokestatic #39; //Method AnotherOuterClass$InnerClass.access$0:(LAnotherOuterClass$InnerClass;)I</div></pre></td></tr></table></figure></p>
<p>再来个总结<br>其中<a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-6.html#jls-6.6.1" target="_blank" rel="external">java官方文档</a> 有这样一句话<br>if the member or constructor is declared private, then access is permitted if and only if it occurs within the body of the top level class (§7.6) that encloses the declaration of the member or constructor.</p>
<p>意思是 如果（内部类的）成员和构造方法设定成了私有修饰符，当且仅当其外部类访问时是允许的。<br>如何让内部类私有成员不被外部访问<br>相信看完上面两部分，你会觉得，内部类的私有成员想不被外部类访问都很困难吧，谁让编译器“爱管闲事”呢，其实也是可以做到的。那就是使用匿名内部类。<br>由于mRunnable对象的类型为Runnable，而不是匿名内部类的类型（我们无法正常拿到），而Runanble中没有x这个属性，所以mRunnable.x是不被允许的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class PrivateToOuter &#123;</div><div class="line">  Runnable mRunnable = new Runnable()&#123;</div><div class="line">      private int x=10;</div><div class="line">      @Override</div><div class="line">      public void run() &#123;</div><div class="line">          System.out.println(x);</div><div class="line">      &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  public static void main(String[] args)&#123;</div><div class="line">      PrivateToOuter p = new PrivateToOuter();</div><div class="line">      //System.out.println(&quot;anonymous class private filed= &quot;+ p.mRunnable.x); //not allowed</div><div class="line">      p.mRunnable.run(); // allowed</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后总结<br>在本文中，private表面上看上去失效了，但实际上是没有的，而是在调用时通过间接的方法来获取私有的属性。<br>Java的内部类构造时持有对外部类的应用，C++不会，这一点和C++不一样。</p>
<p>深入Java细节的书籍<br><a href="http://www.amazon.cn/gp/product/B0011F7WU4/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0011F7WU4&amp;linkCode=as2&amp;tag=droidyue-23" target="_blank" rel="external">Java编程思想</a><img src="http://upload-images.jianshu.io/upload_images/4398977-e1327cdd8167447c?imageMogr2/auto-orient/strip" alt=""><br><a href="http://www.amazon.cn/gp/product/B001PTGR52/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B001PTGR52&amp;linkCode=as2&amp;tag=droidyue-23" target="_blank" rel="external">Sun 公司核心技术丛书:Effective Java中文版</a><img src="http://upload-images.jianshu.io/upload_images/4398977-bff8ef82187333df?imageMogr2/auto-orient/strip" alt=""><br><a href="http://www.amazon.cn/gp/product/B00D2ID4PK/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B00D2ID4PK&amp;linkCode=as2&amp;tag=droidyue-23" target="_blank" rel="external">深入理解Java虚拟机:JVM高级特性与最佳实践</a><img src="http://upload-images.jianshu.io/upload_images/4398977-1881a22db7263d9d?imageMogr2/auto-orient/strip" alt=""></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/02/12/失效的private修饰符/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2016-01-02T06:04:33.000Z"><a href="/2016/01/02/View的scrollTo-和scrollBy-区别/">2016-01-02</a></time>
        
  
    <h1 class="title"><a href="/2016/01/02/View的scrollTo-和scrollBy-区别/">View的scrollTo()和scrollBy()区别</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p>首先，需要知道的是，View是可以延伸到屏幕之外的，可以想象一下ListVIew或GridView。也就是说View的尺寸可以超过屏幕的尺寸。View的大小就是onDraw()中Canvas画布的大小。Canvas可以做translate()、clipRec()t等变换，可以说Canvas是无边界的。而我们在屏幕上所见到的，只是Canvas的一部分而已。可以调用View的scrollTo()和scrollBy()将视图绘制到指定区域。那么View中的scrollTo()和scrollBy()又是怎么回事呢？<br>要想一探究竟，就需要研究一下View的源码。<br>在View的源码中，mScrollX和mScrollY是视图在X轴和Y轴的偏移量。源码注释说的非常清楚mScrollX和mScrollY代表的是什么。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * The offset, in pixels, by which the content of this view is scrolled</div><div class="line"> * horizontally.</div><div class="line"> * &#123;@hide&#125;</div><div class="line"> */</div><div class="line">@ViewDebug.ExportedProperty(category = &quot;scrolling&quot;)</div><div class="line">protected int mScrollX;</div><div class="line">/**</div><div class="line"> * The offset, in pixels, by which the content of this view is scrolled</div><div class="line"> * vertically.</div><div class="line"> * &#123;@hide&#125;</div><div class="line"> */</div><div class="line">@ViewDebug.ExportedProperty(category = &quot;scrolling&quot;)</div><div class="line">protected int mScrollY;</div><div class="line"></div><div class="line"></div><div class="line"> /**</div><div class="line"> * Return the scrolled left position of this view. This is the left edge of</div><div class="line"> * the displayed part of your view. You do not need to draw any pixels</div><div class="line"> * farther left, since those are outside of the frame of your view on</div><div class="line"> * screen.</div><div class="line"> *</div><div class="line"> * @return The left edge of the displayed part of your view, in pixels.</div><div class="line"> */</div><div class="line">public final int getScrollX() &#123;</div><div class="line">    return mScrollX;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Return the scrolled top position of this view. This is the top edge of</div><div class="line"> * the displayed part of your view. You do not need to draw any pixels above</div><div class="line"> * it, since those are outside of the frame of your view on screen.</div><div class="line"> *</div><div class="line"> * @return The top edge of the displayed part of your view, in pixels.</div><div class="line"> */</div><div class="line">public final int getScrollY() &#123;</div><div class="line">    return mScrollY;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>知道了mScrollX和mScrollY的含义，接下来再看scrollTo()和scrollBy()的具体实现，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Set the scrolled position of your view. This will cause a call to</div><div class="line"> * &#123;@link #onScrollChanged(int, int, int, int)&#125; and the view will be</div><div class="line"> * invalidated.</div><div class="line"> * @param x the x position to scroll to</div><div class="line"> * @param y the y position to scroll to</div><div class="line"> */</div><div class="line">public void scrollTo(int x, int y) &#123;</div><div class="line">    if (mScrollX != x || mScrollY != y) &#123;</div><div class="line">        int oldX = mScrollX;</div><div class="line">        int oldY = mScrollY;</div><div class="line">        mScrollX = x;</div><div class="line">        mScrollY = y;</div><div class="line">        onScrollChanged(mScrollX, mScrollY, oldX, oldY);</div><div class="line">        if (!awakenScrollBars()) &#123;</div><div class="line">            invalidate();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Move the scrolled position of your view. This will cause a call to</div><div class="line"> * &#123;@link #onScrollChanged(int, int, int, int)&#125; and the view will be</div><div class="line"> * invalidated.</div><div class="line"> * @param x the amount of pixels to scroll by horizontally</div><div class="line"> * @param y the amount of pixels to scroll by vertically</div><div class="line"> */</div><div class="line">public void scrollBy(int x, int y) &#123;</div><div class="line">    scrollTo(mScrollX + x, mScrollY + y);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从源码中可以看到，scrollBy()的内部其实是调用了scrollTo()。在scrollTo()中，调用了onScrollChanged()和invalidate()。<br>onScrollChanged()的作用就是告诉系统（可以理解为<a href="http://lib.csdn.net/base/android" target="_blank" rel="external">Android</a>框架），这个View的scrollTo()或scrollBy()曾经被调用过；而invalidate()是告诉系统，这个View需要被重新绘制。<br>接下来，探究一下onScrollChanged()和invalidate()的具体实现，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * This is called in response to an internal scroll in this view (i.e., the</div><div class="line"> * view scrolled its own contents). This is typically as a result of</div><div class="line"> * &#123;@link #scrollBy(int, int)&#125; or &#123;@link #scrollTo(int, int)&#125; having been</div><div class="line"> * called.</div><div class="line"> *</div><div class="line"> * @param l Current horizontal scroll origin.</div><div class="line"> * @param t Current vertical scroll origin.</div><div class="line"> * @param oldl Previous horizontal scroll origin.</div><div class="line"> * @param oldt Previous vertical scroll origin.</div><div class="line"> */</div><div class="line">protected void onScrollChanged(int l, int t, int oldl, int oldt) &#123;</div><div class="line">    mBackgroundSizeChanged = true;</div><div class="line"></div><div class="line">    final AttachInfo ai = mAttachInfo;</div><div class="line">    if (ai != null) &#123;</div><div class="line">        ai.mViewScrollChanged = true;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>/**</p>
<pre><code> * Invalidate the whole view. If the view is visible, {@link #onDraw} will
 * be called at some point in the future. This must be called from a
 * UI thread. To call from a non-UI thread, call {@link #postInvalidate()}.
 */
public void invalidate() {
    if (ViewDebug.TRACE_HIERARCHY) {
        ViewDebug.trace(this, ViewDebug.HierarchyTraceType.INVALIDATE);
    }

    if ((mPrivateFlags &amp; (DRAWN | HAS_BOUNDS)) == (DRAWN | HAS_BOUNDS)) {
        mPrivateFlags &amp;= ~DRAWN &amp; ~DRAWING_CACHE_VALID;
        final ViewParent p = mParent;
        final AttachInfo ai = mAttachInfo;
        if (p != null &amp;&amp; ai != null) {
            final Rect r = ai.mTmpInvalRect;
            r.set(0, 0, mRight - mLeft, mBottom - mTop);
            // Don&apos;t call invalidate -- we don&apos;t want to internally scroll
            // our own bounds
            p.invalidateChild(this, r);
        }
    }
}
</code></pre><p>知道了scrollTo()和scrollBy()的意义，那么举个例子，感性地认识一下。<br>假设有一个View，它叫做SView。<br>如果想把SView从(0, 0)移动到(100, 100)。注意，这里说的(0, 0)和(100, 100)，指的是SView左上角的坐标。那么偏移量就是原点(0, 0)到目标点(100, 100)的距离，即(0 , 0) - (100, 100) = (-100, -100)。<br>只需要调用SView.scrollTo(-100, -100)就可以了。请再次注意，scrollTo(int x, int y)的两个参数x和y，代表的是偏移量，这时的参照物是(0, 0)点。<br>然而，scrollBy()是有一定的区别的。scrollBy()的参照物是(0, 0)点加上偏移量之后的坐标。<br>这么描述比较抽象，举个例子。假设SView调用了scrollTo(-100, -100)，此时SView左上角的坐标是(100, 100)，这时再调用scrollBy(-20, -20)，此时SView的左上角就被绘制到了(120, 120)这个位置。<br>总结一下，scrollTo()是一步到位，而scrollBy()是逐步累加。</p>
<p>那么mScrollX和mScrollY又是在哪里被使用的呢？<br>上面说过，scrollTo()会使视图重绘，那究竟是如何绘制的？请看draw()方法，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Manually render this view (and all of its children) to the given Canvas.</div><div class="line"> * The view must have already done a full layout before this function is</div><div class="line"> * called.  When implementing a view, do not override this method; instead,</div><div class="line"> * you should implement &#123;@link #onDraw&#125;.</div><div class="line"> *</div><div class="line"> * @param canvas The Canvas to which the View is rendered.</div><div class="line"> */</div><div class="line">public void draw(Canvas canvas) &#123;</div><div class="line">    if (ViewDebug.TRACE_HIERARCHY) &#123;</div><div class="line">        ViewDebug.trace(this, ViewDebug.HierarchyTraceType.DRAW);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    final int privateFlags = mPrivateFlags;</div><div class="line">    final boolean dirtyOpaque = (privateFlags &amp; DIRTY_MASK) == DIRTY_OPAQUE &amp;&amp;</div><div class="line">            (mAttachInfo == null || !mAttachInfo.mIgnoreDirtyState);</div><div class="line">    mPrivateFlags = (privateFlags &amp; ~DIRTY_MASK) | DRAWN;</div><div class="line"></div><div class="line">    /*</div><div class="line">     * Draw traversal performs several drawing steps which must be executed</div><div class="line">     * in the appropriate order:</div><div class="line">     *</div><div class="line">     *      1. Draw the background</div><div class="line">     *      2. If necessary, save the canvas&apos; layers to prepare for fading</div><div class="line">     *      3. Draw view&apos;s content</div><div class="line">     *      4. Draw children</div><div class="line">     *      5. If necessary, draw the fading edges and restore layers</div><div class="line">     *      6. Draw decorations (scrollbars for instance)</div><div class="line">     */</div><div class="line"></div><div class="line">    // Step 1, draw the background, if needed</div><div class="line">    int saveCount;</div><div class="line"></div><div class="line">    if (!dirtyOpaque) &#123;</div><div class="line">        final Drawable background = mBGDrawable;</div><div class="line">        if (background != null) &#123;</div><div class="line">            final int scrollX = mScrollX;</div><div class="line">            final int scrollY = mScrollY;</div><div class="line"></div><div class="line">            if (mBackgroundSizeChanged) &#123;</div><div class="line">                background.setBounds(0, 0,  mRight - mLeft, mBottom - mTop);</div><div class="line">                mBackgroundSizeChanged = false;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if ((scrollX | scrollY) == 0) &#123;</div><div class="line">                background.draw(canvas);</div><div class="line">            &#125; else &#123;</div><div class="line">                canvas.translate(scrollX, scrollY);</div><div class="line">                background.draw(canvas);</div><div class="line">                canvas.translate(-scrollX, -scrollY);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // skip step 2 &amp; 5 if possible (common case)</div><div class="line">    final int viewFlags = mViewFlags;</div><div class="line">    boolean horizontalEdges = (viewFlags &amp; FADING_EDGE_HORIZONTAL) != 0;</div><div class="line">    boolean verticalEdges = (viewFlags &amp; FADING_EDGE_VERTICAL) != 0;</div><div class="line">    if (!verticalEdges &amp;&amp; !horizontalEdges) &#123;</div><div class="line">        // Step 3, draw the content</div><div class="line">        if (!dirtyOpaque) onDraw(canvas);</div><div class="line"></div><div class="line">        // Step 4, draw the children</div><div class="line">        dispatchDraw(canvas);</div><div class="line"></div><div class="line">        // Step 6, draw decorations (scrollbars)</div><div class="line">        onDrawScrollBars(canvas);</div><div class="line"></div><div class="line">        // we&apos;re done...</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /*</div><div class="line">     * Here we do the full fledged routine...</div><div class="line">     * (this is an uncommon case where speed matters less,</div><div class="line">     * this is why we repeat some of the tests that have been</div><div class="line">     * done above)</div><div class="line">     */</div><div class="line"></div><div class="line">    boolean drawTop = false;</div><div class="line">    boolean drawBottom = false;</div><div class="line">    boolean drawLeft = false;</div><div class="line">    boolean drawRight = false;</div><div class="line"></div><div class="line">    float topFadeStrength = 0.0f;</div><div class="line">    float bottomFadeStrength = 0.0f;</div><div class="line">    float leftFadeStrength = 0.0f;</div><div class="line">    float rightFadeStrength = 0.0f;</div><div class="line"></div><div class="line">    // Step 2, save the canvas&apos; layers</div><div class="line">    int paddingLeft = mPaddingLeft;</div><div class="line">    int paddingTop = mPaddingTop;</div><div class="line"></div><div class="line">    final boolean offsetRequired = isPaddingOffsetRequired();</div><div class="line">    if (offsetRequired) &#123;</div><div class="line">        paddingLeft += getLeftPaddingOffset();</div><div class="line">        paddingTop += getTopPaddingOffset();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int left = mScrollX + paddingLeft;</div><div class="line">    int right = left + mRight - mLeft - mPaddingRight - paddingLeft;</div><div class="line">    int top = mScrollY + paddingTop;</div><div class="line">    int bottom = top + mBottom - mTop - mPaddingBottom - paddingTop;</div><div class="line"></div><div class="line">    if (offsetRequired) &#123;</div><div class="line">        right += getRightPaddingOffset();</div><div class="line">        bottom += getBottomPaddingOffset();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    final ScrollabilityCache scrollabilityCache = mScrollCache;</div><div class="line">    int length = scrollabilityCache.fadingEdgeLength;</div><div class="line"></div><div class="line">    // clip the fade length if top and bottom fades overlap</div><div class="line">    // overlapping fades produce odd-looking artifacts</div><div class="line">    if (verticalEdges &amp;&amp; (top + length &gt; bottom - length)) &#123;</div><div class="line">        length = (bottom - top) / 2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // also clip horizontal fades if necessary</div><div class="line">    if (horizontalEdges &amp;&amp; (left + length &gt; right - length)) &#123;</div><div class="line">        length = (right - left) / 2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (verticalEdges) &#123;</div><div class="line">        topFadeStrength = Math.max(0.0f, Math.min(1.0f, getTopFadingEdgeStrength()));</div><div class="line">        drawTop = topFadeStrength &gt;= 0.0f;</div><div class="line">        bottomFadeStrength = Math.max(0.0f, Math.min(1.0f, getBottomFadingEdgeStrength()));</div><div class="line">        drawBottom = bottomFadeStrength &gt;= 0.0f;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (horizontalEdges) &#123;</div><div class="line">        leftFadeStrength = Math.max(0.0f, Math.min(1.0f, getLeftFadingEdgeStrength()));</div><div class="line">        drawLeft = leftFadeStrength &gt;= 0.0f;</div><div class="line">        rightFadeStrength = Math.max(0.0f, Math.min(1.0f, getRightFadingEdgeStrength()));</div><div class="line">        drawRight = rightFadeStrength &gt;= 0.0f;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    saveCount = canvas.getSaveCount();</div><div class="line"></div><div class="line">    int solidColor = getSolidColor();</div><div class="line">    if (solidColor == 0) &#123;</div><div class="line">        final int flags = Canvas.HAS_ALPHA_LAYER_SAVE_FLAG;</div><div class="line"></div><div class="line">        if (drawTop) &#123;</div><div class="line">            canvas.saveLayer(left, top, right, top + length, null, flags);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (drawBottom) &#123;</div><div class="line">            canvas.saveLayer(left, bottom - length, right, bottom, null, flags);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (drawLeft) &#123;</div><div class="line">            canvas.saveLayer(left, top, left + length, bottom, null, flags);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (drawRight) &#123;</div><div class="line">            canvas.saveLayer(right - length, top, right, bottom, null, flags);</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        scrollabilityCache.setFadeColor(solidColor);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // Step 3, draw the content</div><div class="line">    if (!dirtyOpaque) onDraw(canvas);</div><div class="line"></div><div class="line">    // Step 4, draw the children</div><div class="line">    dispatchDraw(canvas);</div><div class="line"></div><div class="line">    // Step 5, draw the fade effect and restore layers</div><div class="line">    final Paint p = scrollabilityCache.paint;</div><div class="line">    final Matrix matrix = scrollabilityCache.matrix;</div><div class="line">    final Shader fade = scrollabilityCache.shader;</div><div class="line">    final float fadeHeight = scrollabilityCache.fadingEdgeLength;</div><div class="line"></div><div class="line">    if (drawTop) &#123;</div><div class="line">        matrix.setScale(1, fadeHeight * topFadeStrength);</div><div class="line">        matrix.postTranslate(left, top);</div><div class="line">        fade.setLocalMatrix(matrix);</div><div class="line">        canvas.drawRect(left, top, right, top + length, p);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (drawBottom) &#123;</div><div class="line">        matrix.setScale(1, fadeHeight * bottomFadeStrength);</div><div class="line">        matrix.postRotate(180);</div><div class="line">        matrix.postTranslate(left, bottom);</div><div class="line">        fade.setLocalMatrix(matrix);</div><div class="line">        canvas.drawRect(left, bottom - length, right, bottom, p);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (drawLeft) &#123;</div><div class="line">        matrix.setScale(1, fadeHeight * leftFadeStrength);</div><div class="line">        matrix.postRotate(-90);</div><div class="line">        matrix.postTranslate(left, top);</div><div class="line">        fade.setLocalMatrix(matrix);</div><div class="line">        canvas.drawRect(left, top, left + length, bottom, p);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (drawRight) &#123;</div><div class="line">        matrix.setScale(1, fadeHeight * rightFadeStrength);</div><div class="line">        matrix.postRotate(90);</div><div class="line">        matrix.postTranslate(right, top);</div><div class="line">        fade.setLocalMatrix(matrix);</div><div class="line">        canvas.drawRect(right - length, top, right, bottom, p);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    canvas.restoreToCount(saveCount);</div><div class="line"></div><div class="line">    // Step 6, draw decorations (scrollbars)</div><div class="line">    onDrawScrollBars(canvas);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>参考资料<br><a href="http://blog.csdn.net/qinjuning/article/details/7247126" target="_blank" rel="external">http://blog.csdn.net/qinjuning/article/details/7247126</a><br><a href="http://blog.csdn.net/vipzjyno1/article/details/24577023" target="_blank" rel="external">http://blog.csdn.net/vipzjyno1/article/details/24577023</a><br><a href="http://blog.csdn.net/xiaoguochang/article/details/8655210" target="_blank" rel="external">http://blog.csdn.net/xiaoguochang/article/details/8655210</a><br><a href="http://developer.android.com/reference/android/view/View.html#scrollTo%28int,%20int%29" target="_blank" rel="external">http://developer.android.com/reference/android/view/View.html#scrollTo%28int,%20int%29</a></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2016/01/02/View的scrollTo-和scrollBy-区别/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2015-12-12T15:27:49.000Z"><a href="/2015/12/12/Android-studio关于build-outputs-apk-中apk或arr或jar无法删除的解决方法/">2015-12-12</a></time>
        
  
    <h1 class="title"><a href="/2015/12/12/Android-studio关于build-outputs-apk-中apk或arr或jar无法删除的解决方法/">Android studio关于build/outputs/apk/中apk或arr或jar无法删除的解决方法</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p>android studio关于build/outputs/apk/中apk或arr或jar无法删除的解决方法<br>Error:Execution failed for task ‘:app:clean’.&gt; Unable to delete file   后面的文件地址，可能是apk，可能是arr，也可能是classes.jar<br>        在使用Android Studio开发时，部分朋友会遇到这个问题，但是又不是每个人都会遇到。而我则是经常遇到，经过长期开机关机的方式来删除build后，终于决定解决这个问题。还是不负有心人啊，终于找到解决方案，在此分享给大家。其实解决不难，只要2步即可。<br>1、下载工具LockHunter.exe，下载地址：<a href="http://pan.baidu.com/s/1bpFlPL1" target="_blank" rel="external">http://pan.baidu.com/s/1bpFlPL1</a><br>2、在Android Studio中的build.gradle中配置：<br>task clean(type: Exec) {<br>     ext.lockhunter = ‘\”C:\Program Files\LockHunter\LockHunter.exe\“‘<br>     def buildDir = file(new File(“build”))<br>     commandLine ‘cmd’, “$lockhunter”, ‘/delete’, ‘/silent’, buildDir<br>}<br>备注：ext.lockhunter 是你安装lockhunter的地址。<br>           写进的build.gradle是写在应用APP里面的，而不是项目的。</p>
<p>—————————分割线———————————————————–<br>有部分朋友使用上述方法还是不能成功，请接着看：</p>
<p>在出现问题的时候，点击build，同时把手机拔掉，卸载APP，然后插回，在AS上再运行重装。</p>
<p>如果这个方法还不行，那么请把瞬时启动关闭。具体位置：</p>
<p>两个方法一起使用，必定成功。</p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2015/12/12/Android-studio关于build-outputs-apk-中apk或arr或jar无法删除的解决方法/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2015-09-26T05:15:15.000Z"><a href="/2015/09/26/ListView源码分析（二）/">2015-09-26</a></time>
        
  
    <h1 class="title"><a href="/2015/09/26/ListView源码分析（二）/">ListView源码分析（二）</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        <p><strong>ListView的setAdapter实现</strong><br>查看GrepCode网站ListView源码发现setAdapter主要有以下几个重要方法：</p>
<blockquote>
<p>layoutChildren，fillFromTop，fillDown /fillUp<br>makeAndAddView，obtainView，setupChild</p>
</blockquote>
<p>先简单看下layoutChildren源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    protected void layoutChildren() &#123;</div><div class="line">            .........</div><div class="line">			</div><div class="line">            boolean dataChanged = mDataChanged;</div><div class="line">            if (dataChanged) &#123;</div><div class="line">                handleDataChanged();</div><div class="line">            &#125;</div><div class="line">			</div><div class="line">            .........</div><div class="line">			</div><div class="line">            // Clear out old views</div><div class="line">            detachAllViewsFromParent();</div><div class="line"></div><div class="line">            switch (mLayoutMode) &#123;</div><div class="line">            .........</div><div class="line">			</div><div class="line">            case LAYOUT_FORCE_BOTTOM:</div><div class="line">                sel = fillUp(mItemCount - 1, childrenBottom);</div><div class="line">                adjustViewsUpOrDown();</div><div class="line">                break;</div><div class="line">            case LAYOUT_FORCE_TOP:</div><div class="line">                mFirstPosition = 0;</div><div class="line">                sel = fillFromTop(childrenTop);</div><div class="line">                adjustViewsUpOrDown();</div><div class="line">                break;</div><div class="line">				</div><div class="line">            .........</div><div class="line">            &#125;</div><div class="line">			</div><div class="line">	   .........</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>setAdapter之后dataChanged为true，执行handleDataChanged()方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    protected void handleDataChanged() &#123;</div><div class="line">        .........</div><div class="line">		</div><div class="line">        // Nothing is selected. Give up and reset everything.</div><div class="line">        mLayoutMode = mStackFromBottom ? LAYOUT_FORCE_BOTTOM : LAYOUT_FORCE_TOP;</div><div class="line">        mSelectedPosition = INVALID_POSITION;</div><div class="line">        mSelectedRowId = INVALID_ROW_ID;</div><div class="line">        mNextSelectedPosition = INVALID_POSITION;</div><div class="line">        mNextSelectedRowId = INVALID_ROW_ID;</div><div class="line">        mNeedSync = false;</div><div class="line">        mSelectorPosition = INVALID_POSITION;</div><div class="line">        checkSelectionChanged();</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><strong><em>注意这个方法注意是设置mLayoutMode，通常是LAYOUT_FORCE_TOP，即从顶部开始一个一个的往下添加childview。</em></strong><br>&emsp;&emsp;布局中ListView默认没有设置<a href="http://blog.csdn.net/natloc/article/details/50849700" target="_blank" rel="external">android:stackfrombottom</a>属性，因此回到layoutChildren()方法中，执行LAYOUT_FORCE_TOP条件语句，设置mFirstPosition=0后，将childrenTop(=0或padding top 后的值)，进入fillFromTop方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Fills the list from top to bottom, starting with mFirstPosition</div><div class="line">     *</div><div class="line">     * @param nextTop The location where the top of the first item should be</div><div class="line">     *        drawn</div><div class="line">     *</div><div class="line">     * @return The view that is currently selected</div><div class="line">     */</div><div class="line">    private View fillFromTop(int nextTop) &#123;</div><div class="line">        mFirstPosition = Math.min(mFirstPosition, mSelectedPosition);</div><div class="line">        mFirstPosition = Math.min(mFirstPosition, mItemCount - 1);</div><div class="line">        if (mFirstPosition &lt; 0) &#123;</div><div class="line">            mFirstPosition = 0;</div><div class="line">        &#125;</div><div class="line">        return fillDown(mFirstPosition, nextTop);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">/**</div><div class="line">     * Fills the list from pos down to the end of the list view.</div><div class="line">     *</div><div class="line">     * @param pos The first position to put in the list</div><div class="line">     *</div><div class="line">     * @param nextTop The location where the top of the item associated with pos</div><div class="line">     *        should be drawn</div><div class="line">     *</div><div class="line">     * @return The view that is currently selected, if it happens to be in the</div><div class="line">     *         range that we draw.</div><div class="line">     */</div><div class="line">     //第一次进来pos = 0，nexttop 是 padding.top</div><div class="line">    private View fillDown(int pos, int nextTop) &#123;</div><div class="line">        View selectedView = null;</div><div class="line"></div><div class="line">        int end = (mBottom - mTop);//可视区高度</div><div class="line">        if ((mGroupFlags &amp; CLIP_TO_PADDING_MASK) == CLIP_TO_PADDING_MASK) &#123;</div><div class="line">            end -= mListPadding.bottom;//减去paddingbotton属性值</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        while (nextTop &lt; end &amp;&amp; pos &lt; mItemCount) &#123;</div><div class="line">            // is this the selected item?</div><div class="line">            boolean selected = pos == mSelectedPosition;</div><div class="line">            View child = makeAndAddView(pos, nextTop, true, mListPadding.left, selected);</div><div class="line"></div><div class="line">            nextTop = child.getBottom() + mDividerHeight;</div><div class="line">            if (selected) &#123;</div><div class="line">                selectedView = child;</div><div class="line">            &#125;</div><div class="line">            pos++;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return selectedView;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>可视区域的高度(mBottom - mTop)，如果ListView条目很少，可视区高度不超过屏幕高度，最大不超过屏幕高度。<br>&emsp;&emsp;while循环中，判断累计添加到listview中child的高度，不超过可视区域（添加最后一个child时，有可能只显示部分），且添加的child的下标不超过总的个数（否则系统会报 OutOfBounds 的异常）。在循环中，会去调用makeAndAddView，这个方法不会真正的去添加child，但会调用之后的setupChild来真正添加到listview中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Obtain the view and add it to our list of children. The view can be made</div><div class="line">     * fresh, converted from an unused view, or used as is if it was in the</div><div class="line">     * recycle bin.</div><div class="line">     *</div><div class="line">     * @param position Logical position in the list</div><div class="line">     * @param y Top or bottom edge of the view to add</div><div class="line">     * @param flow If flow is true, align top edge to y. If false, align bottom</div><div class="line">     *        edge to y.</div><div class="line">     * @param childrenLeft Left edge where children should be positioned</div><div class="line">     * @param selected Is this position selected?</div><div class="line">     * @return View that was added</div><div class="line">     */</div><div class="line">    private View makeAndAddView(int position, int y, boolean flow, int childrenLeft,</div><div class="line">            boolean selected) &#123;</div><div class="line">        View child;</div><div class="line">        //两种情况：1.数据源没有发生改变 2.数据源发生改变</div><div class="line">        if (!mDataChanged) &#123;</div><div class="line">            // Try to use an existing view for this position</div><div class="line">            child = mRecycler.getActiveView(position);</div><div class="line">            if (child != null) &#123;</div><div class="line">                if (ViewDebug.TRACE_RECYCLER) &#123;</div><div class="line">                    ViewDebug.trace(child, ViewDebug.RecyclerTraceType.RECYCLE_FROM_ACTIVE_HEAP,</div><div class="line">                            position, getChildCount());</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                // Found it -- we&apos;re using an existing child</div><div class="line">                // This just needs to be positioned</div><div class="line">                setupChild(child, position, y, flow, childrenLeft, selected, true);</div><div class="line"></div><div class="line">                return child;//数据源没有发生改变，调用mRecycler.getActiveView(position);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // Make a new view for this position, or convert an unused view if possible</div><div class="line">        child = obtainView(position, mIsScrap);//数据源发生改变，调用obtainView()</div><div class="line"></div><div class="line">        // This needs to be positioned and measured</div><div class="line">        setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[0]);</div><div class="line"></div><div class="line">        return child;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p> 该方法分两种情况： </p>
<ol>
<li><p>adapter中的数据发生了变化，初始setAdapter，或之后我们将adapter中的数据做了新增/删除后，调用Adapter.notifyDataSetChanged；变化了，就会从RecycleBin中的mScrapView中，取之前滑出屏幕的view，即convertView来复用；</p>
</li>
<li><p>若没有变化，则从RecycleBin的mActiveView中取当前显示的view（ 为啥会有这种情况？当listview稳定后，我们不滚动它，但有可能点击或长按 ），这时就会走到这里。<br>&emsp;&emsp;obtainView就是从RecycleBin中，取移出去的View，传给Adapter.getView方法（convertView）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">/*** Get a view and have it show the data associated with the specified</div><div class="line">    * position. This is called when we have already discovered that the view is</div><div class="line">    * not available for reuse in the recycle bin. The only choices left are</div><div class="line">    * converting an old view or making a new one.</div><div class="line">    *</div><div class="line">    * @param position The position to display</div><div class="line">    * @param isScrap Array of at least 1 boolean, the first entry will become true if</div><div class="line">    *                the returned view was taken from the scrap heap, false if otherwise.</div><div class="line">    *</div><div class="line">    * @return A view displaying the data associated with the specified position</div><div class="line">    */</div><div class="line">    </div><div class="line">   View obtainView(int position, boolean[] isScrap) &#123;</div><div class="line">       isScrap[0] = false;</div><div class="line">       View scrapView;</div><div class="line"></div><div class="line">    scrapView = mRecycler.getScrapView(position);//获取scrapView</div><div class="line"></div><div class="line">       View child;</div><div class="line">       if (scrapView != null) &#123;//如果缓存中有，将这个convertView传给Adapter.getView方法</div><div class="line">           if (ViewDebug.TRACE_RECYCLER) &#123;</div><div class="line">               ViewDebug.trace(scrapView, ViewDebug.RecyclerTraceType.RECYCLE_FROM_SCRAP_HEAP,</div><div class="line">                       position, -1);</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           child = mAdapter.getView(position, scrapView, this);</div><div class="line"></div><div class="line">           if (ViewDebug.TRACE_RECYCLER) &#123;</div><div class="line">               ViewDebug.trace(child, ViewDebug.RecyclerTraceType.BIND_VIEW,</div><div class="line">                       position, getChildCount());</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           if (child != scrapView) &#123;//判断从getView方法中返回的view是否与scrapview一致</div><div class="line">           //如果一致，表明是复用的，反之，则程序又去创建了一个新的view（浪费了一块内存），且将得到的scrapview重新加入到RecycleBin.mScrapView中；</div><div class="line">               mRecycler.addScrapView(scrapView, position);</div><div class="line">               if (mCacheColorHint != 0) &#123;</div><div class="line">                   child.setDrawingCacheBackgroundColor(mCacheColorHint);</div><div class="line">               &#125;</div><div class="line">               if (ViewDebug.TRACE_RECYCLER) &#123;</div><div class="line">                   ViewDebug.trace(scrapView, ViewDebug.RecyclerTraceType.MOVE_TO_SCRAP_HEAP,</div><div class="line">                           position, -1);</div><div class="line">               &#125;</div><div class="line">           &#125; else &#123;</div><div class="line">               isScrap[0] = true;</div><div class="line">               child.dispatchFinishTemporaryDetach();</div><div class="line">           &#125;</div><div class="line">       &#125; else &#123;//如果缓存中没有，则convertView为null，在Adapter中，需要自己去LayoutInflater一个view</div><div class="line">           child = mAdapter.getView(position, null, this);</div><div class="line">           if (mCacheColorHint != 0) &#123;</div><div class="line">               child.setDrawingCacheBackgroundColor(mCacheColorHint);</div><div class="line">           &#125;</div><div class="line">           if (ViewDebug.TRACE_RECYCLER) &#123;</div><div class="line">               ViewDebug.trace(child, ViewDebug.RecyclerTraceType.NEW_VIEW,</div><div class="line">                       position, getChildCount());</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       return child;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>这个方法，实际上是在AbsListView类中的。<strong>RecycleBin类，它的作用就是一个View的缓存，将移出屏幕外的view回收，并给新移入到屏幕内的view来复用，这样就能节省大量内存。</strong></p>
</li>
</ol>
<p>回到makeAndAddView方法，将child传给setupChild，开始真正的加入到listView中去显示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Add a view as a child and make sure it is measured (if necessary) and</div><div class="line">     * positioned properly.</div><div class="line">     *</div><div class="line">     * @param child The view to add</div><div class="line">     * @param position The position of this child</div><div class="line">     * @param y The y position relative to which this view will be positioned</div><div class="line">     * @param flowDown If true, align top edge to y. If false, align bottom</div><div class="line">     *        edge to y.</div><div class="line">     * @param childrenLeft Left edge where children should be positioned</div><div class="line">     * @param selected Is this position selected?</div><div class="line">     * @param recycled Has this view been pulled from the recycle bin? If so it</div><div class="line">     *        does not need to be remeasured.</div><div class="line">     */</div><div class="line">private void setupChild(View child, int position, int y, boolean flowDown, int childrenLeft,boolean selected, boolean recycled) &#123;</div><div class="line">        final boolean isSelected = selected &amp;&amp; shouldShowSelector();</div><div class="line">        final boolean updateChildSelected = isSelected != child.isSelected();</div><div class="line">        final int mode = mTouchMode;</div><div class="line">        final boolean isPressed = mode &gt; TOUCH_MODE_DOWN &amp;&amp; mode &lt; TOUCH_MODE_SCROLL &amp;&amp;</div><div class="line">                mMotionPosition == position;</div><div class="line">        final boolean updateChildPressed = isPressed != child.isPressed();</div><div class="line">        final boolean needToMeasure = !recycled || updateChildSelected || child.isLayoutRequested();</div><div class="line"></div><div class="line">        // Respect layout params that are already in the view. Otherwise make some up...</div><div class="line">        // noinspection unchecked</div><div class="line">        AbsListView.LayoutParams p = (AbsListView.LayoutParams) child.getLayoutParams();</div><div class="line">        if (p == null) &#123;</div><div class="line">            p = new AbsListView.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,</div><div class="line">                    ViewGroup.LayoutParams.WRAP_CONTENT, 0);</div><div class="line">        &#125;</div><div class="line">        p.viewType = mAdapter.getItemViewType(position);</div><div class="line"></div><div class="line">        if ((recycled &amp;&amp; !p.forceAdd) || (p.recycledHeaderFooter &amp;&amp;</div><div class="line">                p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER)) &#123;</div><div class="line">            attachViewToParent(child, flowDown ? -1 : 0, p);</div><div class="line">        &#125; else &#123;</div><div class="line">            p.forceAdd = false;</div><div class="line">            if (p.viewType == AdapterView.ITEM_VIEW_TYPE_HEADER_OR_FOOTER) &#123;</div><div class="line">                p.recycledHeaderFooter = true;</div><div class="line">            &#125;</div><div class="line">            addViewInLayout(child, flowDown ? -1 : 0, p, true);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (updateChildSelected) &#123;</div><div class="line">            child.setSelected(isSelected);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (updateChildPressed) &#123;</div><div class="line">            child.setPressed(isPressed);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (mChoiceMode != CHOICE_MODE_NONE &amp;&amp; mCheckStates != null) &#123;</div><div class="line">            if (child instanceof Checkable) &#123;</div><div class="line">                ((Checkable) child).setChecked(mCheckStates.get(position));</div><div class="line">            &#125; else if (getContext().getApplicationInfo().targetSdkVersion</div><div class="line">                    &gt;= android.os.Build.VERSION_CODES.HONEYCOMB) &#123;</div><div class="line">                child.setActivated(mCheckStates.get(position));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        //如果需要测量,先测量子view</div><div class="line">        if (needToMeasure) &#123;</div><div class="line">            int childWidthSpec = ViewGroup.getChildMeasureSpec(mWidthMeasureSpec,</div><div class="line">                    mListPadding.left + mListPadding.right, p.width);</div><div class="line">            int lpHeight = p.height;</div><div class="line">            int childHeightSpec;</div><div class="line">            if (lpHeight &gt; 0) &#123;</div><div class="line">                childHeightSpec = MeasureSpec.makeMeasureSpec(lpHeight, MeasureSpec.EXACTLY);</div><div class="line">            &#125; else &#123;</div><div class="line">                childHeightSpec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</div><div class="line">            &#125;</div><div class="line">            child.measure(childWidthSpec, childHeightSpec);</div><div class="line">        &#125; else &#123;</div><div class="line">            cleanupLayoutState(child);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        final int w = child.getMeasuredWidth();</div><div class="line">        final int h = child.getMeasuredHeight();</div><div class="line">        final int childTop = flowDown ? y : y - h;</div><div class="line"></div><div class="line">        if (needToMeasure) &#123;</div><div class="line">            final int childRight = childrenLeft + w;</div><div class="line">            final int childBottom = childTop + h;</div><div class="line">            child.layout(childrenLeft, childTop, childRight, childBottom);</div><div class="line">        &#125; else &#123;</div><div class="line">            child.offsetLeftAndRight(childrenLeft - child.getLeft());</div><div class="line">            child.offsetTopAndBottom(childTop - child.getTop());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (mCachingStarted &amp;&amp; !child.isDrawingCacheEnabled()) &#123;</div><div class="line">            child.setDrawingCacheEnabled(true);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (recycled &amp;&amp; (((AbsListView.LayoutParams)child.getLayoutParams()).scrappedFromPosition)</div><div class="line">                != position) &#123;</div><div class="line">            child.jumpDrawablesToCurrentState();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;attachViewToParent 和 addViewInLayout两者大致差不多，都是将view添加到parent view的array中，区别在于，attachView是不用去requestLayout的，而addViewInLayout的最后一个参数指明（true不用requestLayout，false则需要requestLayout），这两个方法都在ViewGroup中。<br>&emsp;&emsp;flowDown ? -1 : 0 ， -1 和 0 的区别？我们看下attachViewToParent代码吧：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Attaches a view to this view group. Attaching a view assigns this group as the parent,</div><div class="line">     * sets the layout parameters and puts the view in the list of children so it can be retrieved</div><div class="line">     * by calling &#123;@link #getChildAt(int)&#125;.</div><div class="line">     *</div><div class="line">     * This method should be called only for view which were detached from their parent.</div><div class="line">     *</div><div class="line">     * @param child the child to attach</div><div class="line">     * @param index the index at which the child should be attached</div><div class="line">     * @param params the layout parameters of the child</div><div class="line">     *</div><div class="line">     * @see #removeDetachedView(View, boolean)</div><div class="line">     * @see #detachAllViewsFromParent()</div><div class="line">     * @see #detachViewFromParent(View)</div><div class="line">     * @see #detachViewFromParent(int)</div><div class="line">     */</div><div class="line">    protected void attachViewToParent(View child, int index, LayoutParams params) &#123;</div><div class="line">        child.mLayoutParams = params;</div><div class="line"></div><div class="line">        if (index &lt; 0) &#123;</div><div class="line">            index = mChildrenCount;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        addInArray(child, index);</div><div class="line"></div><div class="line">        child.mParent = this;</div><div class="line">        child.mPrivateFlags = (child.mPrivateFlags &amp; ~DIRTY_MASK &amp; ~DRAWING_CACHE_VALID) |</div><div class="line">                DRAWN | INVALIDATED;</div><div class="line">        this.mPrivateFlags |= INVALIDATED;</div><div class="line"></div><div class="line">        if (child.hasFocus()) &#123;</div><div class="line">            requestChildFocus(child, child.findFocus());</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>如果是-1，则将index = mChildrenCount，即从当前child view数组的尾部开始加入，如果是0， 则从当前child view的头部开始加入。<br>&emsp;&emsp;默认情况下，添加到listview中的item，即child都会measure一次高度和宽度，然后，调用child.layout，通知新添加的child，layout一下它里面的children。<br>&emsp;&emsp;然后，然后就没有了然后，整个流程走完，回到ListView.layoutChildren中，adjustViewsUpOrDown将所有child调整对齐，刷新一下RecycleBin的Active和Scrap缓存，调用updateScrollIndicators更新一下滚动条的值，若有注意OnScrollListener，也通知一下invokeOnItemScrollListener。</p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2015/09/26/ListView源码分析（二）/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



 
<nav id="pagination">
  
    <a href="/page/8/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/10/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
      <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title" id="categories">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cordova/">Cordova</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQTT/">MQTT</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenCV/">OpenCV</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SSL/">SSL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin/">kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安卓直播开发/">安卓直播开发</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">7</span></li></ul> 
</div>
 


  <div class="widget tag">
  <h3 class="title">微信公众账号</h3>
    <ul class="entry">
      <img src="/img/default/wx.png" alt="欢迎关注，该账号供个人学习使用，主要分享安卓开发技术以及前沿技术。" style= "width: 100%">
    </ul>
</div>

  <div class="widget tag">
  <h3 class="title">日历云</h3>
  <div id="calendar"></div>
</div>


  
<div class="widget">
  <h3 class="title">最新评论</h3>
  	<!-- 多说最新评论 start -->
	<div class="ds-recent-comments ds-recent-user" data-num-items="5" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></div>
	<!-- 多说最新评论 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"samychen"};
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0] 
			 || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
		</script>
	<!-- 多说公共JS代码 end -->
</div>



  


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Cordova/" style="font-size: 15px;">Cordova</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/MQTT/" style="font-size: 11.67px;">MQTT</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/SSL，Https/" style="font-size: 13.33px;">SSL，Https</a> <a href="/tags/SSL，Https，安卓/" style="font-size: 10px;">SSL，Https，安卓</a> <a href="/tags/单例模式/" style="font-size: 11.67px;">单例模式</a> <a href="/tags/安卓/" style="font-size: 16.67px;">安卓</a> <a href="/tags/安卓，Java/" style="font-size: 18.33px;">安卓，Java</a> <a href="/tags/工厂模式/" style="font-size: 10px;">工厂模式</a> <a href="/tags/生产者消费者模式/" style="font-size: 11.67px;">生产者消费者模式</a> <a href="/tags/网络协议/" style="font-size: 10px;">网络协议</a> <a href="/tags/装饰者模式/" style="font-size: 11.67px;">装饰者模式</a>
  </div>
</div>


  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">公元 2018 年</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">公元 2017 年</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">公元 2016 年</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">公元 2015 年</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/">公元 2014 年</a><span class="archive-list-count">10</span></li></ul>
  </div>

</aside>
      <div class="clearfix"></div>
    </div>
  
  <footer id="footer"><div class="footer-content inner">
  <div class="alignleft">
  
    &copy; 2018 SamyChen
    
  </div>
  <div class="alignright">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme
    <a href="https://github.com/pengloo53/Hexo-theme-light_cn">light_cn</a>
  </div>
  
  <div class="visit">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </div>
  
  <div class="clearfix"></div>
</div></footer>
  <script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<!-- calendar widget -->

  <script src="/js/calendar.js"></script>
  <script src="/js/languages.js"></script>
  <script type="text/javascript">
    $(function() {
    
      $('#calendar').aCalendar('zh-CN',{single:undefined, root:'calendar'});
    
    });
  </script>


<!-- 『不蒜子』计数服务 -->
<script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- wumii关联推荐 -->
<script type="text/javascript" src="http://widget.wumii.cn/ext/relatedItemsWidget"></script>

<!-- 百度推荐 -->

	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?9acf0cedd48dc53be256ede5a98c2aaa";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


<!-- 返回顶部 -->
<div id="toTop">
	<a href="#">▲</a>
	<a href="#footer">▼</a>
</div>

<!-- 站内搜索-Swiftype -->
<!-- <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','sC-iNFrvTTNtiXEVNwo1','2.0.0');
</script> -->

<!-- fancybox -->

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
